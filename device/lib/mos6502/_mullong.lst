                              1 ;-------------------------------------------------------------------------
                              2 ;   _mullong.s - routine for multiplication of 32 bit (unsigned) long
                              3 ;
                              4 ;   Copyright (C) 1998, Ullrich von Bassewitz
                              5 ;   Copyright (C) 2022, Gabriele Gorla
                              6 ;
                              7 ;   This library is free software; you can redistribute it and/or modify it
                              8 ;   under the terms of the GNU General Public License as published by the
                              9 ;   Free Software Foundation; either version 2, or (at your option) any
                             10 ;   later version.
                             11 ;
                             12 ;   This library is distributed in the hope that it will be useful,
                             13 ;   but WITHOUT ANY WARRANTY; without even the implied warranty of
                             14 ;   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                             15 ;   GNU General Public License for more details.
                             16 ;
                             17 ;   You should have received a copy of the GNU General Public License
                             18 ;   along with this library; see the file COPYING. If not, write to the
                             19 ;   Free Software Foundation, 51 Franklin Street, Fifth Floor, Boston,
                             20 ;   MA 02110-1301, USA.
                             21 ;
                             22 ;   As a special exception, if you link this library with other files,
                             23 ;   some of which are compiled with SDCC, to produce an executable,
                             24 ;   this library does not by itself cause the resulting executable to
                             25 ;   be covered by the GNU General Public License. This exception does
                             26 ;   not however invalidate any other reasons why the executable file
                             27 ;   might be covered by the GNU General Public License.
                             28 ;-------------------------------------------------------------------------
                             29 
                             30 	.module _mullong
                             31 
                             32 ;--------------------------------------------------------
                             33 ; exported symbols
                             34 ;--------------------------------------------------------
                             35 	.globl __mullong_PARM_2
                             36 	.globl __mullong_PARM_1
                             37 	.globl __mullong
                             38 
                             39 ;--------------------------------------------------------
                             40 ; overlayable function paramters in zero page
                             41 ;--------------------------------------------------------
                             42 	.area	OSEG    (PAG, OVR)
   0000                      43 __mullong_PARM_1:
   0000                      44 	.ds 4
   0004                      45 __mullong_PARM_2:
   0004                      46 	.ds 4
                             47 
                             48 ;--------------------------------------------------------
                             49 ; local aliases
                             50 ;--------------------------------------------------------
                             51 	.define tmp  "___SDCC_m6502_ret4"
                             52 	.define res0 "__mullong_PARM_1+0"
                             53 	.define res1 "__mullong_PARM_1+1"
                             54 	.define res2 "___SDCC_m6502_ret2"
                             55 	.define res3 "___SDCC_m6502_ret3"
                             56 
                             57 ;--------------------------------------------------------
                             58 ; code
                             59 ;--------------------------------------------------------
                             60 	.area CODE
                             61 
   0000                      62 __mullong:
                             63 
   0000 A6*03         [ 3]   64         ldx	*__mullong_PARM_1+3
   0002 86*00         [ 3]   65         stx	*res3
   0004 A6*02         [ 3]   66         ldx	*__mullong_PARM_1+2
   0006 86*00         [ 3]   67         stx	*res2
                             68 ;        ldx	*__mullong_PARM_1+1
                             69 ;        stx	*res1
                             70 ;        ldx	*__mullong_PARM_1+0
                             71 ;        stx	*res0
                             72 
   0008 A9 00         [ 2]   73         lda     #0
   000A 85*02         [ 3]   74         sta     *tmp+2
   000C 85*01         [ 3]   75         sta     *tmp+1
   000E 85*00         [ 3]   76         sta     *tmp+0
                             77 
   0010 A0 20         [ 2]   78         ldy     #32
   0012                      79 next_bit:
   0012 46*02         [ 5]   80 	lsr     *tmp+2
   0014 66*01         [ 5]   81         ror     *tmp+1
   0016 66*00         [ 5]   82         ror     *tmp+0
   0018 6A            [ 2]   83         ror     a
   0019 66*00         [ 5]   84         ror     *res3
   001B 66*00         [ 5]   85         ror     *res2
   001D 66*01         [ 5]   86         ror     *res1
   001F 66*00         [ 5]   87         ror     *res0
   0021 90 17         [ 4]   88         bcc     skip
   0023 18            [ 2]   89         clc
   0024 65*04         [ 3]   90         adc     *__mullong_PARM_2+0
   0026 AA            [ 2]   91         tax
   0027 A5*05         [ 3]   92         lda     *__mullong_PARM_2+1
   0029 65*00         [ 3]   93         adc     *tmp+0
   002B 85*00         [ 3]   94         sta     *tmp+0
   002D A5*06         [ 3]   95         lda     *__mullong_PARM_2+2
   002F 65*01         [ 3]   96         adc     *tmp+1
   0031 85*01         [ 3]   97         sta     *tmp+1
   0033 A5*07         [ 3]   98         lda     *__mullong_PARM_2+3
   0035 65*02         [ 3]   99         adc     *tmp+2
   0037 85*02         [ 3]  100         sta     *tmp+2
   0039 8A            [ 2]  101         txa
   003A                     102 skip:
   003A 88            [ 2]  103         dey
   003B 10 D5         [ 4]  104         bpl	next_bit
   003D A6*01         [ 3]  105         ldx	*res1
   003F A5*00         [ 3]  106         lda	*res0
   0041 60            [ 6]  107 	rts
