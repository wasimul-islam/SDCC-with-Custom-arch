                              1 ;-------------------------------------------------------------------------
                              2 ;   _mulschar.s - routine for multiplication of 16 bit (unsigned) int
                              3 ;
                              4 ;   Copyright (C) 2009, Ullrich von Bassewitz
                              5 ;   Copyright (C) 2022, Gabriele Gorla
                              6 ;
                              7 ;   This library is free software; you can redistribute it and/or modify it
                              8 ;   under the terms of the GNU General Public License as published by the
                              9 ;   Free Software Foundation; either version 2, or (at your option) any
                             10 ;   later version.
                             11 ;
                             12 ;   This library is distributed in the hope that it will be useful,
                             13 ;   but WITHOUT ANY WARRANTY; without even the implied warranty of
                             14 ;   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                             15 ;   GNU General Public License for more details.
                             16 ;
                             17 ;   You should have received a copy of the GNU General Public License
                             18 ;   along with this library; see the file COPYING. If not, write to the
                             19 ;   Free Software Foundation, 51 Franklin Street, Fifth Floor, Boston,
                             20 ;   MA 02110-1301, USA.
                             21 ;
                             22 ;   As a special exception, if you link this library with other files,
                             23 ;   some of which are compiled with SDCC, to produce an executable,
                             24 ;   this library does not by itself cause the resulting executable to
                             25 ;   be covered by the GNU General Public License. This exception does
                             26 ;   not however invalidate any other reasons why the executable file
                             27 ;   might be covered by the GNU General Public License.
                             28 ;-------------------------------------------------------------------------
                             29 
                             30 	.module _mulschar
                             31 
                             32 ;--------------------------------------------------------
                             33 ; exported symbols
                             34 ;--------------------------------------------------------
                             35 	.globl __mulschar
                             36 	.globl __muluschar
                             37 	.globl __mulsuchar
                             38 
                             39 ;--------------------------------------------------------
                             40 ; overlayable function paramters in zero page
                             41 ;--------------------------------------------------------
                             42 	.area	OSEG    (PAG, OVR)
                             43 
                             44 ;--------------------------------------------------------
                             45 ; local aliases
                             46 ;--------------------------------------------------------
                             47 	.define arg1 "___SDCC_m6502_ret0"
                             48 	.define arg2 "___SDCC_m6502_ret2"
                             49 	.define s1 "___SDCC_m6502_ret4"
                             50 	.define s2 "___SDCC_m6502_ret5"
                             51 
                             52 ;--------------------------------------------------------
                             53 ; code
                             54 ;--------------------------------------------------------
                             55 	.area CODE
                             56 
   0000                      57 __mulschar:
   0000 8Dr00r00      [ 4]   58 	sta	s1
   0003 C9 00         [ 2]   59 	cmp	#0x00
   0005 10 05         [ 4]   60 	bpl 	pos1
   0007 38            [ 2]   61 	sec
   0008 49 FF         [ 2]   62 	eor	#0xff
   000A 69 00         [ 2]   63 	adc	#0x00
   000C                      64 pos1:	
   000C 8Dr00r00      [ 4]   65 	sta     arg1
   000F 8A            [ 2]   66 	txa
   0010 8Dr00r00      [ 4]   67 	sta	s2
   0013 10 05         [ 4]   68 	bpl 	pos2
   0015 38            [ 2]   69 	sec
   0016 49 FF         [ 2]   70 	eor	#0xff
   0018 69 00         [ 2]   71 	adc	#0x00
   001A                      72 pos2:	
   001A 8Dr00r00      [ 4]   73 	sta     arg2
                             74 	
   001D 20r00r00      [ 6]   75 	jsr 	___umul8
   0020 ADr00r00      [ 4]   76 	lda	s1
   0023 4Dr00r00      [ 4]   77 	eor	s2
   0026 10 06         [ 4]   78 	bpl	skip
   0028 ADr00r00      [ 4]   79 	lda	arg2
   002B 4Cr00r00      [ 3]   80 	jmp	___negax
                             81 
   002E ADr00r00      [ 4]   82 skip:	lda 	arg2
   0031 60            [ 6]   83 	rts
                             84 
   0032                      85 __muluschar:
   0032 8Er00r00      [ 4]   86 	stx	__mulint_PARM_2
   0035 A2 00         [ 2]   87 	ldx	#0x00
   0037 8Er01r00      [ 4]   88 	stx	__mulint_PARM_2+1
   003A C9 00         [ 2]   89 	cmp	#0x00
   003C 10 02         [ 4]   90 	bpl	pos1m
   003E A2 FF         [ 2]   91 	ldx 	#0xff
   0040                      92 pos1m:
   0040 4Cr00r00      [ 3]   93 	jmp	__mulint
                             94 	
   0043                      95 __mulsuchar:
   0043 8Dr00r00      [ 4]   96 	sta	__mulint_PARM_2
   0046 8A            [ 2]   97 	txa
   0047 A2 00         [ 2]   98 	ldx	#0x00
   0049 8Er01r00      [ 4]   99 	stx	__mulint_PARM_2+1
   004C C9 00         [ 2]  100 	cmp	#0x00
   004E 10 02         [ 4]  101 	bpl	pos2m
   0050 A2 FF         [ 2]  102 	ldx 	#0xff
   0052                     103 pos2m:
   0052 4Cr00r00      [ 3]  104 	jmp	__mulint
