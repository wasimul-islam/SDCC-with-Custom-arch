                              1 ;-------------------------------------------------------------------------
                              2 ;   _mulint.s - routine for multiplication of 16 bit (unsigned) int
                              3 ;
                              4 ;   Copyright (C) 2009, Ullrich von Bassewitz
                              5 ;   Copyright (C) 2022, Gabriele Gorla
                              6 ;
                              7 ;   This library is free software; you can redistribute it and/or modify it
                              8 ;   under the terms of the GNU General Public License as published by the
                              9 ;   Free Software Foundation; either version 2, or (at your option) any
                             10 ;   later version.
                             11 ;
                             12 ;   This library is distributed in the hope that it will be useful,
                             13 ;   but WITHOUT ANY WARRANTY; without even the implied warranty of
                             14 ;   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                             15 ;   GNU General Public License for more details.
                             16 ;
                             17 ;   You should have received a copy of the GNU General Public License
                             18 ;   along with this library; see the file COPYING. If not, write to the
                             19 ;   Free Software Foundation, 51 Franklin Street, Fifth Floor, Boston,
                             20 ;   MA 02110-1301, USA.
                             21 ;
                             22 ;   As a special exception, if you link this library with other files,
                             23 ;   some of which are compiled with SDCC, to produce an executable,
                             24 ;   this library does not by itself cause the resulting executable to
                             25 ;   be covered by the GNU General Public License. This exception does
                             26 ;   not however invalidate any other reasons why the executable file
                             27 ;   might be covered by the GNU General Public License.
                             28 ;-------------------------------------------------------------------------
                             29 
                             30 	.module _mulint
                             31 
                             32 ;--------------------------------------------------------
                             33 ; exported symbols
                             34 ;--------------------------------------------------------
                             35 	.globl __mulint_PARM_2
                             36 	.globl __mulint
                             37 
                             38 ;--------------------------------------------------------
                             39 ; overlayable function paramters in zero page
                             40 ;--------------------------------------------------------
                             41 	.area	OSEG    (PAG, OVR)
   0000                      42 __mulint_PARM_2:
   0000                      43 	.ds 2
                             44 
                             45 ;--------------------------------------------------------
                             46 ; local aliases
                             47 ;--------------------------------------------------------
                             48 	.define tmp "___SDCC_m6502_ret2"
                             49 
                             50 ;--------------------------------------------------------
                             51 ; code
                             52 ;--------------------------------------------------------
                             53 	.area CODE
                             54 
   0000                      55 __mulint:
   0000 85*00         [ 3]   56 	sta	*___SDCC_m6502_ret0
   0002 86*00         [ 3]   57 	stx	*___SDCC_m6502_ret1
   0004 A9 00         [ 2]   58 	lda	#0
   0006 85*00         [ 3]   59 	sta	*tmp
   0008 A0 10         [ 2]   60 	ldy	#16
   000A 46*00         [ 5]   61 	lsr	*___SDCC_m6502_ret1
   000C 66*00         [ 5]   62 	ror	*___SDCC_m6502_ret0
   000E                      63 next_bit:
   000E 90 0B         [ 4]   64 	bcc	skip
   0010 18            [ 2]   65 	clc
   0011 65*00         [ 3]   66 	adc	*__mulint_PARM_2+0
   0013 AA            [ 2]   67 	tax
   0014 A5*01         [ 3]   68 	lda	*__mulint_PARM_2+1
   0016 65*00         [ 3]   69 	adc	*tmp
   0018 85*00         [ 3]   70 	sta	*tmp
   001A 8A            [ 2]   71 	txa
   001B                      72 skip:
   001B 66*00         [ 5]   73 	ror	*tmp
   001D 6A            [ 2]   74 	ror	a
   001E 66*00         [ 5]   75 	ror	*___SDCC_m6502_ret1
   0020 66*00         [ 5]   76 	ror	*___SDCC_m6502_ret0
   0022 88            [ 2]   77 	dey
   0023 D0 E9         [ 4]   78 	bne	next_bit
                             79 
   0025 A5*00         [ 3]   80 	lda	*___SDCC_m6502_ret0
   0027 A6*00         [ 3]   81 	ldx	*___SDCC_m6502_ret1
   0029 60            [ 6]   82 	rts
