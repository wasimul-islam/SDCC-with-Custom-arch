                              1 ;--------------------------------------------------------
                              2 ; File Created by SDCC : free open source ISO C Compiler 
                              3 ; Version 4.2.14 #0 (Linux)
                              4 ;--------------------------------------------------------
                              5 	.module c16rtomb
                              6 	.optsdcc -mmos6502
                              7 	
                              8 ;--------------------------------------------------------
                              9 ; Public variables in this module
                             10 ;--------------------------------------------------------
                             11 	.globl _wctomb
                             12 	.globl _c16rtomb_PARM_3
                             13 	.globl _c16rtomb_PARM_2
                             14 	.globl _c16rtomb
                             15 ;--------------------------------------------------------
                             16 ; ZP ram data
                             17 ;--------------------------------------------------------
                             18 	.area ZP      (PAG)
   0000                      19 _c16rtomb_sloc0_1_0:
   0000                      20 	.ds 2
   0002                      21 _c16rtomb_sloc1_1_0:
   0002                      22 	.ds 2
   0004                      23 _c16rtomb_sloc2_1_0:
   0004                      24 	.ds 2
   0006                      25 _c16rtomb_sloc3_1_0:
   0006                      26 	.ds 2
   0008                      27 _c16rtomb_sloc4_1_0:
   0008                      28 	.ds 2
   000A                      29 _c16rtomb_sloc5_1_0:
   000A                      30 	.ds 4
                             31 ;--------------------------------------------------------
                             32 ; overlayable items in ram
                             33 ;--------------------------------------------------------
                             34 ;--------------------------------------------------------
                             35 ; uninitialized external ram data
                             36 ;--------------------------------------------------------
                             37 	.area BSS
   0000                      38 _c16rtomb_PARM_2:
   0000                      39 	.ds 2
   0002                      40 _c16rtomb_PARM_3:
   0002                      41 	.ds 2
   0004                      42 _c16rtomb_s_65536_42:
   0004                      43 	.ds 2
   0006                      44 _c16rtomb_codepoint_65536_43:
   0006                      45 	.ds 4
   000A                      46 _c16rtomb_buf_65536_43:
   000A                      47 	.ds 4
   000E                      48 _c16rtomb_sps_65536_43:
   000E                      49 	.ds 3
   0011                      50 _c16rtomb_high_surrogate_131072_45:
   0011                      51 	.ds 2
                             52 ;--------------------------------------------------------
                             53 ; absolute external ram data
                             54 ;--------------------------------------------------------
                             55 	.area DABS    (ABS)
                             56 ;--------------------------------------------------------
                             57 ; initialized external ram data
                             58 ;--------------------------------------------------------
                             59 	.area DATA
                             60 ;--------------------------------------------------------
                             61 ; global & static initialisations
                             62 ;--------------------------------------------------------
                             63 	.area _CODE
                             64 	.area GSINIT
                             65 	.area GSFINAL
                             66 	.area GSINIT
                             67 ;--------------------------------------------------------
                             68 ; Home
                             69 ;--------------------------------------------------------
                             70 	.area _CODE
                             71 	.area _CODE
                             72 ;--------------------------------------------------------
                             73 ; code
                             74 ;--------------------------------------------------------
                             75 	.area CODE
                             76 ;------------------------------------------------------------
                             77 ;Allocation info for local variables in function 'c16rtomb'
                             78 ;------------------------------------------------------------
                             79 ;sloc0                     Allocated with name '_c16rtomb_sloc0_1_0'
                             80 ;sloc1                     Allocated with name '_c16rtomb_sloc1_1_0'
                             81 ;sloc2                     Allocated with name '_c16rtomb_sloc2_1_0'
                             82 ;sloc3                     Allocated with name '_c16rtomb_sloc3_1_0'
                             83 ;sloc4                     Allocated with name '_c16rtomb_sloc4_1_0'
                             84 ;sloc5                     Allocated with name '_c16rtomb_sloc5_1_0'
                             85 ;c16                       Allocated with name '_c16rtomb_PARM_2'
                             86 ;ps                        Allocated with name '_c16rtomb_PARM_3'
                             87 ;s                         Allocated with name '_c16rtomb_s_65536_42'
                             88 ;codepoint                 Allocated with name '_c16rtomb_codepoint_65536_43'
                             89 ;buf                       Allocated with name '_c16rtomb_buf_65536_43'
                             90 ;sps                       Allocated with name '_c16rtomb_sps_65536_43'
                             91 ;high_surrogate            Allocated with name '_c16rtomb_high_surrogate_131072_45'
                             92 ;------------------------------------------------------------
                             93 ;	../c16rtomb.c: 35: size_t c16rtomb(char *restrict s, char16_t c16, mbstate_t *restrict ps)
                             94 ;	-----------------------------------------
                             95 ;	 function c16rtomb
                             96 ;	-----------------------------------------
                             97 ;	Register assignment is optimal.
                             98 ;	Stack space usage: 0 bytes.
   0000                      99 _c16rtomb:
   0000 8Dr04r00      [ 4]  100 	sta	_c16rtomb_s_65536_42
   0003 8Er05r00      [ 4]  101 	stx	(_c16rtomb_s_65536_42 + 1)
                            102 ;	../c16rtomb.c: 41: if(!s)
   0006 ADr05r00      [ 4]  103 	lda	(_c16rtomb_s_65536_42 + 1)
   0009 0Dr04r00      [ 4]  104 	ora	_c16rtomb_s_65536_42
   000C D0 0A         [ 4]  105 	bne	00102$
                            106 ;	../c16rtomb.c: 42: s = buf;
   000E A9r0A         [ 2]  107 	lda	#_c16rtomb_buf_65536_43
   0010 8Dr04r00      [ 4]  108 	sta	_c16rtomb_s_65536_42
   0013 A9s00         [ 2]  109 	lda	#>_c16rtomb_buf_65536_43
   0015 8Dr05r00      [ 4]  110 	sta	(_c16rtomb_s_65536_42 + 1)
   0018                     111 00102$:
                            112 ;	../c16rtomb.c: 44: if(!ps)
   0018 ADr03r00      [ 4]  113 	lda	(_c16rtomb_PARM_3 + 1)
   001B 0Dr02r00      [ 4]  114 	ora	_c16rtomb_PARM_3
   001E D0 0A         [ 4]  115 	bne	00104$
                            116 ;	../c16rtomb.c: 45: ps = &sps;
   0020 A9r0E         [ 2]  117 	lda	#_c16rtomb_sps_65536_43
   0022 8Dr02r00      [ 4]  118 	sta	_c16rtomb_PARM_3
   0025 A9s00         [ 2]  119 	lda	#>_c16rtomb_sps_65536_43
   0027 8Dr03r00      [ 4]  120 	sta	(_c16rtomb_PARM_3 + 1)
   002A                     121 00104$:
                            122 ;	../c16rtomb.c: 47: if (!c16) // 0 always resets conversion state.
   002A ADr01r00      [ 4]  123 	lda	(_c16rtomb_PARM_2 + 1)
   002D 0Dr00r00      [ 4]  124 	ora	_c16rtomb_PARM_2
   0030 D0 26         [ 4]  125 	bne	00119$
                            126 ;	../c16rtomb.c: 49: ps->c[1] = ps->c[2] = 0;
   0032 ADr02r00      [ 4]  127 	lda	_c16rtomb_PARM_3
   0035 AEr03r00      [ 4]  128 	ldx	(_c16rtomb_PARM_3 + 1)
   0038 85*00         [ 3]  129 	sta	*_c16rtomb_sloc0_1_0
   003A 86*01         [ 3]  130 	stx	*(_c16rtomb_sloc0_1_0 + 1)
   003C 85*00         [ 3]  131 	sta	*(__DPTR+0)
   003E 86*01         [ 3]  132 	stx	*(__DPTR+1)
   0040 A9 00         [ 2]  133 	lda	#0x00
   0042 A0 02         [ 2]  134 	ldy	#0x02
   0044 91*00         [ 6]  135 	sta	[__DPTR],y
   0046 88            [ 2]  136 	dey
   0047 91*00         [ 6]  137 	sta	[*_c16rtomb_sloc0_1_0],y
                            138 ;	../c16rtomb.c: 50: codepoint = 0;
   0049 8Dr06r00      [ 4]  139 	sta	_c16rtomb_codepoint_65536_43
   004C 8Dr07r00      [ 4]  140 	sta	(_c16rtomb_codepoint_65536_43 + 1)
   004F 8Dr08r00      [ 4]  141 	sta	(_c16rtomb_codepoint_65536_43 + 2)
   0052 8Dr09r00      [ 4]  142 	sta	(_c16rtomb_codepoint_65536_43 + 3)
   0055 4Cr55r01      [ 3]  143 	jmp	00120$
   0058                     144 00119$:
                            145 ;	../c16rtomb.c: 52: else if(ps->c[1] || ps->c[2]) // We already have the high surrogate. Now get the low surrogate
   0058 ADr02r00      [ 4]  146 	lda	_c16rtomb_PARM_3
   005B AEr03r00      [ 4]  147 	ldx	(_c16rtomb_PARM_3 + 1)
   005E 85*00         [ 3]  148 	sta	*_c16rtomb_sloc0_1_0
   0060 86*01         [ 3]  149 	stx	*(_c16rtomb_sloc0_1_0 + 1)
   0062 85*00         [ 3]  150 	sta	*(__TEMP+0)
   0064 A0 01         [ 2]  151 	ldy	#0x01
   0066 B1*00         [ 6]  152 	lda	[*_c16rtomb_sloc0_1_0],y
   0068 A8            [ 2]  153 	tay
   0069 A5*00         [ 3]  154 	lda	*(__TEMP+0)
   006B C0 00         [ 2]  155 	cpy	#0x00
   006D D0 0D         [ 4]  156 	bne	00114$
   006F 85*02         [ 3]  157 	sta	*_c16rtomb_sloc1_1_0
   0071 86*03         [ 3]  158 	stx	*(_c16rtomb_sloc1_1_0 + 1)
   0073 A0 02         [ 2]  159 	ldy	#0x02
   0075 B1*02         [ 6]  160 	lda	[*_c16rtomb_sloc1_1_0],y
   0077 D0 03         [ 4]  161 	bne	00160$
   0079 4Cr0Br01      [ 3]  162 	jmp	00115$
   007C                     163 00160$:
   007C                     164 00114$:
                            165 ;	../c16rtomb.c: 56: if(c16 < 0xdc00 || c16 > 0xdfff)
   007C ADr01r00      [ 4]  166 	lda	(_c16rtomb_PARM_2 + 1)
   007F 38            [ 2]  167 	sec
   0080 E9 DC         [ 2]  168 	sbc	#0xdc
   0082 B0 03         [ 4]  169 	bcs	00161$
   0084 4Cr76r01      [ 3]  170 	jmp	00121$
   0087                     171 00161$:
   0087 A9 FF         [ 2]  172 	lda	#0xff
   0089 38            [ 2]  173 	sec
   008A EDr00r00      [ 4]  174 	sbc	_c16rtomb_PARM_2
   008D A9 DF         [ 2]  175 	lda	#0xdf
   008F EDr01r00      [ 4]  176 	sbc	(_c16rtomb_PARM_2 + 1)
   0092 B0 03         [ 4]  177 	bcs	00162$
   0094 4Cr76r01      [ 3]  178 	jmp	00121$
   0097                     179 00162$:
                            180 ;	../c16rtomb.c: 59: high_surrogate = ps->c[1] + (ps->c[2] << 8);
   0097 ADr02r00      [ 4]  181 	lda	_c16rtomb_PARM_3
   009A AEr03r00      [ 4]  182 	ldx	(_c16rtomb_PARM_3 + 1)
   009D 85*04         [ 3]  183 	sta	*_c16rtomb_sloc2_1_0
   009F 86*05         [ 3]  184 	stx	*(_c16rtomb_sloc2_1_0 + 1)
   00A1 85*00         [ 3]  185 	sta	*(__TEMP+0)
   00A3 A0 01         [ 2]  186 	ldy	#0x01
   00A5 B1*04         [ 6]  187 	lda	[*_c16rtomb_sloc2_1_0],y
   00A7 A8            [ 2]  188 	tay
   00A8 A5*00         [ 3]  189 	lda	*(__TEMP+0)
   00AA 84*06         [ 3]  190 	sty	*_c16rtomb_sloc3_1_0
   00AC 48            [ 3]  191 	pha
   00AD A9 00         [ 2]  192 	lda	#0x00
   00AF 85*07         [ 3]  193 	sta	*(_c16rtomb_sloc3_1_0 + 1)
   00B1 68            [ 4]  194 	pla
   00B2 85*08         [ 3]  195 	sta	*_c16rtomb_sloc4_1_0
   00B4 86*09         [ 3]  196 	stx	*(_c16rtomb_sloc4_1_0 + 1)
   00B6 A0 02         [ 2]  197 	ldy	#0x02
   00B8 B1*08         [ 6]  198 	lda	[*_c16rtomb_sloc4_1_0],y
   00BA AA            [ 2]  199 	tax
   00BB A9 00         [ 2]  200 	lda	#0x00
   00BD 18            [ 2]  201 	clc
   00BE 65*06         [ 3]  202 	adc	*_c16rtomb_sloc3_1_0
   00C0 8Dr11r00      [ 4]  203 	sta	_c16rtomb_high_surrogate_131072_45
   00C3 8A            [ 2]  204 	txa
   00C4 65*07         [ 3]  205 	adc	*(_c16rtomb_sloc3_1_0 + 1)
   00C6 8Dr12r00      [ 4]  206 	sta	(_c16rtomb_high_surrogate_131072_45 + 1)
                            207 ;	../c16rtomb.c: 60: ps->c[1] = ps->c[2] = 0;
   00C9 A9 00         [ 2]  208 	lda	#0x00
   00CB 91*08         [ 6]  209 	sta	[*_c16rtomb_sloc4_1_0],y
   00CD 88            [ 2]  210 	dey
   00CE 91*04         [ 6]  211 	sta	[*_c16rtomb_sloc2_1_0],y
                            212 ;	../c16rtomb.c: 61: codepoint = (high_surrogate << 10) - (0xd800 << 10) + c16 - 0xdc00 + 0x10000;
   00D0 ADr11r00      [ 4]  213 	lda	_c16rtomb_high_surrogate_131072_45
   00D3 0A            [ 2]  214 	asl	a
   00D4 0A            [ 2]  215 	asl	a
   00D5 AA            [ 2]  216 	tax
   00D6 A9 00         [ 2]  217 	lda	#0x00
   00D8 18            [ 2]  218 	clc
   00D9 6Dr00r00      [ 4]  219 	adc	_c16rtomb_PARM_2
   00DC 48            [ 3]  220 	pha
   00DD 8A            [ 2]  221 	txa
   00DE 6Dr01r00      [ 4]  222 	adc	(_c16rtomb_PARM_2 + 1)
   00E1 AA            [ 2]  223 	tax
   00E2 68            [ 4]  224 	pla
   00E3 85*0A         [ 3]  225 	sta	*_c16rtomb_sloc5_1_0
   00E5 86*0B         [ 3]  226 	stx	*(_c16rtomb_sloc5_1_0 + 1)
   00E7 88            [ 2]  227 	dey
   00E8 84*0C         [ 3]  228 	sty	*(_c16rtomb_sloc5_1_0 + 2)
   00EA 84*0D         [ 3]  229 	sty	*(_c16rtomb_sloc5_1_0 + 3)
   00EC A5*0A         [ 3]  230 	lda	*_c16rtomb_sloc5_1_0
   00EE 18            [ 2]  231 	clc
   00EF 8Dr06r00      [ 4]  232 	sta	_c16rtomb_codepoint_65536_43
   00F2 A5*0B         [ 3]  233 	lda	*(_c16rtomb_sloc5_1_0 + 1)
   00F4 18            [ 2]  234 	clc
   00F5 69 24         [ 2]  235 	adc	#0x24
   00F7 8Dr07r00      [ 4]  236 	sta	(_c16rtomb_codepoint_65536_43 + 1)
   00FA A5*0C         [ 3]  237 	lda	*(_c16rtomb_sloc5_1_0 + 2)
   00FC 69 00         [ 2]  238 	adc	#0x00
   00FE 8Dr08r00      [ 4]  239 	sta	(_c16rtomb_codepoint_65536_43 + 2)
   0101 A5*0D         [ 3]  240 	lda	*(_c16rtomb_sloc5_1_0 + 3)
   0103 69 00         [ 2]  241 	adc	#0x00
   0105 8Dr09r00      [ 4]  242 	sta	(_c16rtomb_codepoint_65536_43 + 3)
   0108 4Cr55r01      [ 3]  243 	jmp	00120$
   010B                     244 00115$:
                            245 ;	../c16rtomb.c: 63: else if(c16 < 0xd7ff || c16 >= 0xe000) // Basic multilingual plane.
   010B ADr00r00      [ 4]  246 	lda	_c16rtomb_PARM_2
   010E 38            [ 2]  247 	sec
   010F E9 FF         [ 2]  248 	sbc	#0xff
   0111 ADr01r00      [ 4]  249 	lda	(_c16rtomb_PARM_2 + 1)
   0114 E9 D7         [ 2]  250 	sbc	#0xd7
   0116 90 08         [ 4]  251 	bcc	00110$
   0118 ADr01r00      [ 4]  252 	lda	(_c16rtomb_PARM_2 + 1)
   011B 38            [ 2]  253 	sec
   011C E9 E0         [ 2]  254 	sbc	#0xe0
   011E 90 17         [ 4]  255 	bcc	00111$
   0120                     256 00110$:
                            257 ;	../c16rtomb.c: 64: codepoint = c16;
   0120 ADr00r00      [ 4]  258 	lda	_c16rtomb_PARM_2
   0123 8Dr06r00      [ 4]  259 	sta	_c16rtomb_codepoint_65536_43
   0126 ADr01r00      [ 4]  260 	lda	(_c16rtomb_PARM_2 + 1)
   0129 8Dr07r00      [ 4]  261 	sta	(_c16rtomb_codepoint_65536_43 + 1)
   012C A2 00         [ 2]  262 	ldx	#0x00
   012E 8Er08r00      [ 4]  263 	stx	(_c16rtomb_codepoint_65536_43 + 2)
   0131 8Er09r00      [ 4]  264 	stx	(_c16rtomb_codepoint_65536_43 + 3)
   0134 4Cr55r01      [ 3]  265 	jmp	00120$
   0137                     266 00111$:
                            267 ;	../c16rtomb.c: 67: if(c16 > 0xdbff)
   0137 A9 FF         [ 2]  268 	lda	#0xff
   0139 38            [ 2]  269 	sec
   013A EDr00r00      [ 4]  270 	sbc	_c16rtomb_PARM_2
   013D A9 DB         [ 2]  271 	lda	#0xdb
   013F EDr01r00      [ 4]  272 	sbc	(_c16rtomb_PARM_2 + 1)
   0142 90 32         [ 4]  273 	bcc	00121$
                            274 ;	../c16rtomb.c: 70: ps->c[1] = c16 & 0xff;
   0144 ADr00r00      [ 4]  275 	lda	_c16rtomb_PARM_2
   0147 A0 01         [ 2]  276 	ldy	#0x01
   0149 91*00         [ 6]  277 	sta	[*_c16rtomb_sloc0_1_0],y
                            278 ;	../c16rtomb.c: 71: ps->c[2] = c16 >> 8;
   014B ADr01r00      [ 4]  279 	lda	(_c16rtomb_PARM_2 + 1)
   014E C8            [ 2]  280 	iny
   014F 91*02         [ 6]  281 	sta	[*_c16rtomb_sloc1_1_0],y
                            282 ;	../c16rtomb.c: 72: return(0);
   0151 A9 00         [ 2]  283 	lda	#0x00
   0153 AA            [ 2]  284 	tax
   0154 60            [ 6]  285 	rts
   0155                     286 00120$:
                            287 ;	../c16rtomb.c: 75: return(wctomb(s, codepoint));
   0155 ADr06r00      [ 4]  288 	lda	_c16rtomb_codepoint_65536_43
   0158 8Dr00r00      [ 4]  289 	sta	_wctomb_PARM_2
   015B ADr07r00      [ 4]  290 	lda	(_c16rtomb_codepoint_65536_43 + 1)
   015E 8Dr01r00      [ 4]  291 	sta	(_wctomb_PARM_2 + 1)
   0161 ADr08r00      [ 4]  292 	lda	(_c16rtomb_codepoint_65536_43 + 2)
   0164 8Dr02r00      [ 4]  293 	sta	(_wctomb_PARM_2 + 2)
   0167 ADr09r00      [ 4]  294 	lda	(_c16rtomb_codepoint_65536_43 + 3)
   016A 8Dr03r00      [ 4]  295 	sta	(_wctomb_PARM_2 + 3)
   016D AEr05r00      [ 4]  296 	ldx	(_c16rtomb_s_65536_42 + 1)
   0170 ADr04r00      [ 4]  297 	lda	_c16rtomb_s_65536_42
   0173 4Cr00r00      [ 3]  298 	jmp	_wctomb
                            299 ;	../c16rtomb.c: 77: eilseq:
   0176                     300 00121$:
                            301 ;	../c16rtomb.c: 78: errno = EILSEQ;
   0176 A2 54         [ 2]  302 	ldx	#0x54
   0178 8Er00r00      [ 4]  303 	stx	_errno
   017B A2 00         [ 2]  304 	ldx	#0x00
   017D 8Er01r00      [ 4]  305 	stx	(_errno + 1)
                            306 ;	../c16rtomb.c: 79: return(-1);
   0180 A9 FF         [ 2]  307 	lda	#0xff
   0182 AA            [ 2]  308 	tax
                            309 ;	../c16rtomb.c: 80: }
   0183 60            [ 6]  310 	rts
                            311 	.area CODE
                            312 	.area RODATA
                            313 	.area XINIT
                            314 	.area CABS    (ABS)
