                              1 ;-------------------------------------------------------------------------
                              2 ;   memcpy.s - standarc C library
                              3 ;
                              4 ;   Copyright (C) 2003, Ullrich von Bassewitz
                              5 ;   Copyright (C) 2009, Christian Krueger
                              6 ;   Copyright (C) 2022, Gabriele Gorla
                              7 ;
                              8 ;   This library is free software; you can redistribute it and/or modify it
                              9 ;   under the terms of the GNU General Public License as published by the
                             10 ;   Free Software Foundation; either version 2, or (at your option) any
                             11 ;   later version.
                             12 ;
                             13 ;   This library is distributed in the hope that it will be useful,
                             14 ;   but WITHOUT ANY WARRANTY; without even the implied warranty of
                             15 ;   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                             16 ;   GNU General Public License for more details.
                             17 ;
                             18 ;   You should have received a copy of the GNU General Public License
                             19 ;   along with this library; see the file COPYING. If not, write to the
                             20 ;   Free Software Foundation, 51 Franklin Street, Fifth Floor, Boston,
                             21 ;   MA 02110-1301, USA.
                             22 ;
                             23 ;   As a special exception, if you link this library with other files,
                             24 ;   some of which are compiled with SDCC, to produce an executable,
                             25 ;   this library does not by itself cause the resulting executable to
                             26 ;   be covered by the GNU General Public License. This exception does
                             27 ;   not however invalidate any other reasons why the executable file
                             28 ;   might be covered by the GNU General Public License.
                             29 ;-------------------------------------------------------------------------
                             30 
                             31 	.module ___memcpy
                             32 
                             33 ;--------------------------------------------------------
                             34 ; exported symbols
                             35 ;--------------------------------------------------------
                             36 	.globl ___memcpy_PARM_2
                             37 	.globl ___memcpy_PARM_3
                             38 	.globl ___memcpy
                             39 
                             40 ;--------------------------------------------------------
                             41 ; overlayable function paramters in zero page
                             42 ;--------------------------------------------------------
                             43 	.area	OSEG    (PAG, OVR)
   0000                      44 ___memcpy_PARM_2:
   0000                      45 	.ds 2
   0002                      46 ___memcpy_PARM_3:
   0002                      47 	.ds 2
                             48 
                             49 ;--------------------------------------------------------
                             50 ; local aliases
                             51 ;--------------------------------------------------------
                             52 	.define save  "___SDCC_m6502_ret0"
                             53 	.define dst   "___SDCC_m6502_ret2"
                             54 	.define src   "___memcpy_PARM_2"
                             55 	.define count "___memcpy_PARM_3"
                             56 	
                             57 ;--------------------------------------------------------
                             58 ; code
                             59 ;--------------------------------------------------------
                             60 	.area CODE
                             61 
   0000                      62 ___memcpy:
   0000 85*00         [ 3]   63 	sta	*save+0
   0002 86*01         [ 3]   64 	stx	*save+1
   0004 85*00         [ 3]   65 	sta	*dst+0
   0006 86*01         [ 3]   66 	stx	*dst+1
                             67 
   0008 A0 00         [ 2]   68 	ldy	#0
   000A A6*03         [ 3]   69 	ldx	*count+1
   000C F0 13         [ 4]   70 	beq	L2
   000E                      71 L1:
   000E B1*00         [ 6]   72 	lda	[*src],y
   0010 91*00         [ 6]   73 	sta	[*dst],y
   0012 C8            [ 2]   74 	iny
   0013 B1*00         [ 6]   75 	lda	[*src],y
   0015 91*00         [ 6]   76 	sta	[*dst],y
   0017 C8            [ 2]   77 	iny
   0018 D0 F4         [ 4]   78 	bne	L1
   001A E6*01         [ 5]   79 	inc	*src+1
   001C E6*01         [ 5]   80 	inc	*dst+1
   001E CA            [ 2]   81 	dex
   001F D0 ED         [ 4]   82 	bne	L1
   0021                      83 L2:
   0021 A6*02         [ 3]   84 	ldx	*count+0
   0023 F0 08         [ 4]   85 	beq	done
   0025                      86 L3:
   0025 B1*00         [ 6]   87 	lda	[*src],y
   0027 91*00         [ 6]   88 	sta	[*dst],y
   0029 C8            [ 2]   89 	iny
   002A CA            [ 2]   90 	dex
   002B D0 F8         [ 4]   91 	bne	L3
   002D                      92 done:
   002D A5*00         [ 3]   93 	lda	*save+0
   002F A6*01         [ 3]   94 	ldx	*save+1
   0031 60            [ 6]   95 	rts
