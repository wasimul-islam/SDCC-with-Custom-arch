                              1 ;--------------------------------------------------------
                              2 ; File Created by SDCC : free open source ISO C Compiler 
                              3 ; Version 4.2.14 #0 (Linux)
                              4 ;--------------------------------------------------------
                              5 	.module c16rtomb
                              6 	.optsdcc -mhc08
                              7 	
                              8 	.area HOME    (CODE)
                              9 	.area GSINIT0 (CODE)
                             10 	.area GSINIT  (CODE)
                             11 	.area GSFINAL (CODE)
                             12 	.area CSEG    (CODE)
                             13 	.area XINIT   (CODE)
                             14 	.area CONST   (CODE)
                             15 	.area DSEG    (PAG)
                             16 	.area OSEG    (PAG, OVR)
                             17 	.area XSEG
                             18 	.area XISEG
                             19 ;--------------------------------------------------------
                             20 ; Public variables in this module
                             21 ;--------------------------------------------------------
                             22 	.globl _wctomb
                             23 	.globl _c16rtomb_PARM_3
                             24 	.globl _c16rtomb_PARM_2
                             25 	.globl _c16rtomb
                             26 ;--------------------------------------------------------
                             27 ; ram data
                             28 ;--------------------------------------------------------
                             29 	.area DSEG    (PAG)
   0000                      30 _c16rtomb_sloc0_1_0:
   0000                      31 	.ds 2
   0002                      32 _c16rtomb_sloc1_1_0:
   0002                      33 	.ds 2
   0004                      34 _c16rtomb_sloc2_1_0:
   0004                      35 	.ds 2
   0006                      36 _c16rtomb_sloc3_1_0:
   0006                      37 	.ds 4
                             38 ;--------------------------------------------------------
                             39 ; overlayable items in ram
                             40 ;--------------------------------------------------------
                             41 ;--------------------------------------------------------
                             42 ; absolute ram data
                             43 ;--------------------------------------------------------
                             44 	.area IABS    (ABS)
                             45 	.area IABS    (ABS)
                             46 ;--------------------------------------------------------
                             47 ; absolute external ram data
                             48 ;--------------------------------------------------------
                             49 	.area XABS    (ABS)
                             50 ;--------------------------------------------------------
                             51 ; initialized external ram data
                             52 ;--------------------------------------------------------
                             53 	.area XISEG
                             54 ;--------------------------------------------------------
                             55 ; extended address mode data
                             56 ;--------------------------------------------------------
                             57 	.area XSEG
   0000                      58 _c16rtomb_PARM_2:
   0000                      59 	.ds 2
   0002                      60 _c16rtomb_PARM_3:
   0002                      61 	.ds 2
   0004                      62 _c16rtomb_s_65536_42:
   0004                      63 	.ds 2
   0006                      64 _c16rtomb_codepoint_65536_43:
   0006                      65 	.ds 4
   000A                      66 _c16rtomb_buf_65536_43:
   000A                      67 	.ds 4
   000E                      68 _c16rtomb_sps_65536_43:
   000E                      69 	.ds 3
   0011                      70 _c16rtomb_high_surrogate_131072_45:
   0011                      71 	.ds 2
                             72 ;--------------------------------------------------------
                             73 ; global & static initialisations
                             74 ;--------------------------------------------------------
                             75 	.area HOME    (CODE)
                             76 	.area GSINIT  (CODE)
                             77 	.area GSFINAL (CODE)
                             78 	.area GSINIT  (CODE)
                             79 ;--------------------------------------------------------
                             80 ; Home
                             81 ;--------------------------------------------------------
                             82 	.area HOME    (CODE)
                             83 	.area HOME    (CODE)
                             84 ;--------------------------------------------------------
                             85 ; code
                             86 ;--------------------------------------------------------
                             87 	.area CSEG    (CODE)
                             88 ;------------------------------------------------------------
                             89 ;Allocation info for local variables in function 'c16rtomb'
                             90 ;------------------------------------------------------------
                             91 ;sloc0                     Allocated with name '_c16rtomb_sloc0_1_0'
                             92 ;sloc1                     Allocated with name '_c16rtomb_sloc1_1_0'
                             93 ;sloc2                     Allocated with name '_c16rtomb_sloc2_1_0'
                             94 ;sloc3                     Allocated with name '_c16rtomb_sloc3_1_0'
                             95 ;c16                       Allocated with name '_c16rtomb_PARM_2'
                             96 ;ps                        Allocated with name '_c16rtomb_PARM_3'
                             97 ;s                         Allocated with name '_c16rtomb_s_65536_42'
                             98 ;codepoint                 Allocated with name '_c16rtomb_codepoint_65536_43'
                             99 ;buf                       Allocated with name '_c16rtomb_buf_65536_43'
                            100 ;sps                       Allocated with name '_c16rtomb_sps_65536_43'
                            101 ;high_surrogate            Allocated with name '_c16rtomb_high_surrogate_131072_45'
                            102 ;------------------------------------------------------------
                            103 ;../c16rtomb.c:35: size_t c16rtomb(char *restrict s, char16_t c16, mbstate_t *restrict ps)
                            104 ;	-----------------------------------------
                            105 ;	 function c16rtomb
                            106 ;	-----------------------------------------
                            107 ;	Register assignment is optimal.
                            108 ;	Stack space usage: 0 bytes.
   0000                     109 _c16rtomb:
   0000 C7r00r05      [ 4]  110 	sta	(_c16rtomb_s_65536_42 + 1)
   0003 CFr00r04      [ 4]  111 	stx	_c16rtomb_s_65536_42
                            112 ;../c16rtomb.c:41: if(!s)
   0006 C6r00r04      [ 4]  113 	lda	_c16rtomb_s_65536_42
   0009 CAr00r05      [ 4]  114 	ora	(_c16rtomb_s_65536_42 + 1)
   000C 26 0A         [ 3]  115 	bne	00102$
                            116 ;../c16rtomb.c:42: s = buf;
   000E A6r0A         [ 2]  117 	lda	#_c16rtomb_buf_65536_43
   0010 C7r00r05      [ 4]  118 	sta	(_c16rtomb_s_65536_42 + 1)
   0013 A6s00         [ 2]  119 	lda	#>_c16rtomb_buf_65536_43
   0015 C7r00r04      [ 4]  120 	sta	_c16rtomb_s_65536_42
   0018                     121 00102$:
                            122 ;../c16rtomb.c:44: if(!ps)
   0018 C6r00r02      [ 4]  123 	lda	_c16rtomb_PARM_3
   001B CAr00r03      [ 4]  124 	ora	(_c16rtomb_PARM_3 + 1)
   001E 26 0A         [ 3]  125 	bne	00104$
                            126 ;../c16rtomb.c:45: ps = &sps;
   0020 A6r0E         [ 2]  127 	lda	#_c16rtomb_sps_65536_43
   0022 C7r00r03      [ 4]  128 	sta	(_c16rtomb_PARM_3 + 1)
   0025 A6s00         [ 2]  129 	lda	#>_c16rtomb_sps_65536_43
   0027 C7r00r02      [ 4]  130 	sta	_c16rtomb_PARM_3
   002A                     131 00104$:
                            132 ;../c16rtomb.c:49: ps->c[1] = ps->c[2] = 0;
   002A C6r00r02      [ 4]  133 	lda	_c16rtomb_PARM_3
   002D 87            [ 2]  134 	psha
   002E 8A            [ 2]  135 	pulh
   002F CEr00r03      [ 4]  136 	ldx	(_c16rtomb_PARM_3 + 1)
   0032 35*00         [ 4]  137 	sthx	*_c16rtomb_sloc0_1_0
   0034 35*02         [ 4]  138 	sthx	*_c16rtomb_sloc1_1_0
                            139 ;../c16rtomb.c:47: if (!c16) // 0 always resets conversion state.
   0036 C6r00r00      [ 4]  140 	lda	_c16rtomb_PARM_2
   0039 CAr00r01      [ 4]  141 	ora	(_c16rtomb_PARM_2 + 1)
   003C 26 16         [ 3]  142 	bne	00119$
                            143 ;../c16rtomb.c:49: ps->c[1] = ps->c[2] = 0;
   003E 55*02         [ 4]  144 	ldhx	*_c16rtomb_sloc1_1_0
   0040 4F            [ 1]  145 	clra
   0041 E7 02         [ 3]  146 	sta	2,x
   0043 55*00         [ 4]  147 	ldhx	*_c16rtomb_sloc0_1_0
   0045 E7 01         [ 3]  148 	sta	1,x
                            149 ;../c16rtomb.c:50: codepoint = 0;
   0047 45r00r06      [ 3]  150 	ldhx	#_c16rtomb_codepoint_65536_43
   004A F7            [ 2]  151 	sta	,x
   004B E7 01         [ 3]  152 	sta	1,x
   004D E7 02         [ 3]  153 	sta	2,x
   004F E7 03         [ 3]  154 	sta	3,x
   0051 CCr01r16      [ 3]  155 	jmp	00120$
   0054                     156 00119$:
                            157 ;../c16rtomb.c:52: else if(ps->c[1] || ps->c[2]) // We already have the high surrogate. Now get the low surrogate
   0054 55*00         [ 4]  158 	ldhx	*_c16rtomb_sloc0_1_0
   0056 EE 01         [ 3]  159 	ldx	1,x
   0058 5D            [ 1]  160 	tstx
   0059 26 08         [ 3]  161 	bne	00114$
   005B 89            [ 2]  162 	pshx
   005C 55*02         [ 4]  163 	ldhx	*_c16rtomb_sloc1_1_0
   005E E6 02         [ 3]  164 	lda	2,x
   0060 88            [ 2]  165 	pulx
   0061 27 6E         [ 3]  166 	beq	00115$
   0063                     167 00114$:
                            168 ;../c16rtomb.c:56: if(c16 < 0xdc00 || c16 > 0xdfff)
   0063 C6r00r00      [ 4]  169 	lda	_c16rtomb_PARM_2
   0066 A0 DC         [ 2]  170 	sub	#0xdc
   0068 24 03         [ 3]  171 	bcc	00169$
   006A CCr01r35      [ 3]  172 	jmp	00121$
   006D                     173 00169$:
   006D A6 FF         [ 2]  174 	lda	#0xff
   006F C0r00r01      [ 4]  175 	sub	(_c16rtomb_PARM_2 + 1)
   0072 A6 DF         [ 2]  176 	lda	#0xdf
   0074 C2r00r00      [ 4]  177 	sbc	_c16rtomb_PARM_2
   0077 24 03         [ 3]  178 	bcc	00170$
   0079 CCr01r35      [ 3]  179 	jmp	00121$
   007C                     180 00170$:
                            181 ;../c16rtomb.c:59: high_surrogate = ps->c[1] + (ps->c[2] << 8);
   007C BF*05         [ 3]  182 	stx	*(_c16rtomb_sloc2_1_0 + 1)
   007E 6E 00*04      [ 4]  183 	mov	#0x00,*_c16rtomb_sloc2_1_0
   0081 55*02         [ 4]  184 	ldhx	*_c16rtomb_sloc1_1_0
   0083 E6 02         [ 3]  185 	lda	2,x
   0085 5F            [ 1]  186 	clrx
   0086 97            [ 1]  187 	tax
   0087 4F            [ 1]  188 	clra
   0088 BB*05         [ 3]  189 	add	*(_c16rtomb_sloc2_1_0 + 1)
   008A C7r00r12      [ 4]  190 	sta	(_c16rtomb_high_surrogate_131072_45 + 1)
   008D 9F            [ 1]  191 	txa
   008E B9*04         [ 3]  192 	adc	*_c16rtomb_sloc2_1_0
   0090 C7r00r11      [ 4]  193 	sta	_c16rtomb_high_surrogate_131072_45
                            194 ;../c16rtomb.c:60: ps->c[1] = ps->c[2] = 0;
   0093 55*02         [ 4]  195 	ldhx	*_c16rtomb_sloc1_1_0
   0095 4F            [ 1]  196 	clra
   0096 E7 02         [ 3]  197 	sta	2,x
   0098 55*00         [ 4]  198 	ldhx	*_c16rtomb_sloc0_1_0
   009A E7 01         [ 3]  199 	sta	1,x
                            200 ;../c16rtomb.c:61: codepoint = (high_surrogate << 10) - (0xd800 << 10) + c16 - 0xdc00 + 0x10000;
   009C C6r00r12      [ 4]  201 	lda	(_c16rtomb_high_surrogate_131072_45 + 1)
   009F 48            [ 1]  202 	lsla	
   00A0 48            [ 1]  203 	lsla	
   00A1 97            [ 1]  204 	tax
   00A2 4F            [ 1]  205 	clra
   00A3 CBr00r01      [ 4]  206 	add	(_c16rtomb_PARM_2 + 1)
   00A6 87            [ 2]  207 	psha
   00A7 9F            [ 1]  208 	txa
   00A8 C9r00r00      [ 4]  209 	adc	_c16rtomb_PARM_2
   00AB 97            [ 1]  210 	tax
   00AC 86            [ 2]  211 	pula
   00AD B7*09         [ 3]  212 	sta	*(_c16rtomb_sloc3_1_0 + 3)
   00AF BF*08         [ 3]  213 	stx	*(_c16rtomb_sloc3_1_0 + 2)
   00B1 6E 00*07      [ 4]  214 	mov	#0x00,*(_c16rtomb_sloc3_1_0 + 1)
   00B4 6E 00*06      [ 4]  215 	mov	#0x00,*_c16rtomb_sloc3_1_0
   00B7 45r00r06      [ 3]  216 	ldhx	#_c16rtomb_codepoint_65536_43
   00BA B6*09         [ 3]  217 	lda	*(_c16rtomb_sloc3_1_0 + 3)
   00BC E7 03         [ 3]  218 	sta	3,x
   00BE B6*08         [ 3]  219 	lda	*(_c16rtomb_sloc3_1_0 + 2)
   00C0 AB 24         [ 2]  220 	add	#0x24
   00C2 E7 02         [ 3]  221 	sta	2,x
   00C4 B6*07         [ 3]  222 	lda	*(_c16rtomb_sloc3_1_0 + 1)
   00C6 A9 00         [ 2]  223 	adc	#0x00
   00C8 E7 01         [ 3]  224 	sta	1,x
   00CA B6*06         [ 3]  225 	lda	*_c16rtomb_sloc3_1_0
   00CC A9 00         [ 2]  226 	adc	#0x00
   00CE F7            [ 2]  227 	sta	,x
   00CF 20 45         [ 3]  228 	bra	00120$
   00D1                     229 00115$:
                            230 ;../c16rtomb.c:63: else if(c16 < 0xd7ff || c16 >= 0xe000) // Basic multilingual plane.
   00D1 C6r00r01      [ 4]  231 	lda	(_c16rtomb_PARM_2 + 1)
   00D4 A0 FF         [ 2]  232 	sub	#0xff
   00D6 C6r00r00      [ 4]  233 	lda	_c16rtomb_PARM_2
   00D9 A2 D7         [ 2]  234 	sbc	#0xd7
   00DB 25 07         [ 3]  235 	bcs	00110$
   00DD C6r00r00      [ 4]  236 	lda	_c16rtomb_PARM_2
   00E0 A0 E0         [ 2]  237 	sub	#0xe0
   00E2 25 15         [ 3]  238 	bcs	00111$
   00E4                     239 00110$:
                            240 ;../c16rtomb.c:64: codepoint = c16;
   00E4 C6r00r01      [ 4]  241 	lda	(_c16rtomb_PARM_2 + 1)
   00E7 C7r00r09      [ 4]  242 	sta	(_c16rtomb_codepoint_65536_43 + 3)
   00EA C6r00r00      [ 4]  243 	lda	_c16rtomb_PARM_2
   00ED C7r00r08      [ 4]  244 	sta	(_c16rtomb_codepoint_65536_43 + 2)
   00F0 4F            [ 1]  245 	clra
   00F1 C7r00r07      [ 4]  246 	sta	(_c16rtomb_codepoint_65536_43 + 1)
   00F4 C7r00r06      [ 4]  247 	sta	_c16rtomb_codepoint_65536_43
   00F7 20 1D         [ 3]  248 	bra	00120$
   00F9                     249 00111$:
                            250 ;../c16rtomb.c:67: if(c16 > 0xdbff)
   00F9 A6 FF         [ 2]  251 	lda	#0xff
   00FB C0r00r01      [ 4]  252 	sub	(_c16rtomb_PARM_2 + 1)
   00FE A6 DB         [ 2]  253 	lda	#0xdb
   0100 C2r00r00      [ 4]  254 	sbc	_c16rtomb_PARM_2
   0103 25 30         [ 3]  255 	bcs	00121$
                            256 ;../c16rtomb.c:70: ps->c[1] = c16 & 0xff;
   0105 C6r00r01      [ 4]  257 	lda	(_c16rtomb_PARM_2 + 1)
   0108 55*00         [ 4]  258 	ldhx	*_c16rtomb_sloc0_1_0
   010A E7 01         [ 3]  259 	sta	1,x
                            260 ;../c16rtomb.c:71: ps->c[2] = c16 >> 8;
   010C C6r00r00      [ 4]  261 	lda	_c16rtomb_PARM_2
   010F 55*02         [ 4]  262 	ldhx	*_c16rtomb_sloc1_1_0
   0111 E7 02         [ 3]  263 	sta	2,x
                            264 ;../c16rtomb.c:72: return(0);
   0113 4F            [ 1]  265 	clra
   0114 97            [ 1]  266 	tax
   0115 81            [ 4]  267 	rts
   0116                     268 00120$:
                            269 ;../c16rtomb.c:75: return(wctomb(s, codepoint));
   0116 45r00r00      [ 3]  270 	ldhx	#_wctomb_PARM_2
   0119 C6r00r06      [ 4]  271 	lda	_c16rtomb_codepoint_65536_43
   011C F7            [ 2]  272 	sta	,x
   011D C6r00r07      [ 4]  273 	lda	(_c16rtomb_codepoint_65536_43 + 1)
   0120 E7 01         [ 3]  274 	sta	1,x
   0122 C6r00r08      [ 4]  275 	lda	(_c16rtomb_codepoint_65536_43 + 2)
   0125 E7 02         [ 3]  276 	sta	2,x
   0127 C6r00r09      [ 4]  277 	lda	(_c16rtomb_codepoint_65536_43 + 3)
   012A E7 03         [ 3]  278 	sta	3,x
   012C C6r00r05      [ 4]  279 	lda	(_c16rtomb_s_65536_42 + 1)
   012F CEr00r04      [ 4]  280 	ldx	_c16rtomb_s_65536_42
   0132 CCr00r00      [ 3]  281 	jmp	_wctomb
                            282 ;../c16rtomb.c:77: eilseq:
   0135                     283 00121$:
                            284 ;../c16rtomb.c:78: errno = EILSEQ;
   0135 4F            [ 1]  285 	clra
   0136 C7r00r00      [ 4]  286 	sta	_errno
   0139 A6 54         [ 2]  287 	lda	#0x54
   013B C7r00r01      [ 4]  288 	sta	(_errno + 1)
                            289 ;../c16rtomb.c:79: return(-1);
   013E A6 FF         [ 2]  290 	lda	#0xff
   0140 97            [ 1]  291 	tax
                            292 ;../c16rtomb.c:80: }
   0141 81            [ 4]  293 	rts
                            294 	.area CSEG    (CODE)
                            295 	.area CONST   (CODE)
                            296 	.area XINIT   (CODE)
                            297 	.area CABS    (ABS,CODE)
