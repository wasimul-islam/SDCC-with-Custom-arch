                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ISO C Compiler 
                                      3 ; Version 4.2.14 #0 (Linux)
                                      4 ;--------------------------------------------------------
                                      5 	.module wcstombs
                                      6 	.optsdcc -mmcs51 --model-large
                                      7 	
                                      8 ;--------------------------------------------------------
                                      9 ; Public variables in this module
                                     10 ;--------------------------------------------------------
                                     11 	.globl _wctomb
                                     12 	.globl _wcstombs_PARM_3
                                     13 	.globl _wcstombs_PARM_2
                                     14 	.globl _wcstombs
                                     15 ;--------------------------------------------------------
                                     16 ; special function registers
                                     17 ;--------------------------------------------------------
                                     18 	.area RSEG    (ABS,DATA)
      000000                         19 	.org 0x0000
                                     20 ;--------------------------------------------------------
                                     21 ; special function bits
                                     22 ;--------------------------------------------------------
                                     23 	.area RSEG    (ABS,DATA)
      000000                         24 	.org 0x0000
                                     25 ;--------------------------------------------------------
                                     26 ; overlayable register banks
                                     27 ;--------------------------------------------------------
                                     28 	.area REG_BANK_0	(REL,OVR,DATA)
      000000                         29 	.ds 8
                                     30 ;--------------------------------------------------------
                                     31 ; internal ram data
                                     32 ;--------------------------------------------------------
                                     33 	.area DSEG    (DATA)
      000000                         34 _wcstombs_sloc0_1_0:
      000000                         35 	.ds 2
      000002                         36 _wcstombs_sloc1_1_0:
      000002                         37 	.ds 3
                                     38 ;--------------------------------------------------------
                                     39 ; overlayable items in internal ram
                                     40 ;--------------------------------------------------------
                                     41 ;--------------------------------------------------------
                                     42 ; indirectly addressable internal ram data
                                     43 ;--------------------------------------------------------
                                     44 	.area ISEG    (DATA)
                                     45 ;--------------------------------------------------------
                                     46 ; absolute internal ram data
                                     47 ;--------------------------------------------------------
                                     48 	.area IABS    (ABS,DATA)
                                     49 	.area IABS    (ABS,DATA)
                                     50 ;--------------------------------------------------------
                                     51 ; bit data
                                     52 ;--------------------------------------------------------
                                     53 	.area BSEG    (BIT)
                                     54 ;--------------------------------------------------------
                                     55 ; paged external ram data
                                     56 ;--------------------------------------------------------
                                     57 	.area PSEG    (PAG,XDATA)
                                     58 ;--------------------------------------------------------
                                     59 ; uninitialized external ram data
                                     60 ;--------------------------------------------------------
                                     61 	.area XSEG    (XDATA)
      000000                         62 _wcstombs_PARM_2:
      000000                         63 	.ds 3
      000003                         64 _wcstombs_PARM_3:
      000003                         65 	.ds 2
      000005                         66 _wcstombs_s_65536_39:
      000005                         67 	.ds 3
      000008                         68 _wcstombs_m_65536_40:
      000008                         69 	.ds 2
      00000A                         70 _wcstombs_buffer_65536_40:
      00000A                         71 	.ds 4
                                     72 ;--------------------------------------------------------
                                     73 ; absolute external ram data
                                     74 ;--------------------------------------------------------
                                     75 	.area XABS    (ABS,XDATA)
                                     76 ;--------------------------------------------------------
                                     77 ; initialized external ram data
                                     78 ;--------------------------------------------------------
                                     79 	.area XISEG   (XDATA)
                                     80 	.area HOME    (CODE)
                                     81 	.area GSINIT0 (CODE)
                                     82 	.area GSINIT1 (CODE)
                                     83 	.area GSINIT2 (CODE)
                                     84 	.area GSINIT3 (CODE)
                                     85 	.area GSINIT4 (CODE)
                                     86 	.area GSINIT5 (CODE)
                                     87 	.area GSINIT  (CODE)
                                     88 	.area GSFINAL (CODE)
                                     89 	.area CSEG    (CODE)
                                     90 ;--------------------------------------------------------
                                     91 ; global & static initialisations
                                     92 ;--------------------------------------------------------
                                     93 	.area HOME    (CODE)
                                     94 	.area GSINIT  (CODE)
                                     95 	.area GSFINAL (CODE)
                                     96 	.area GSINIT  (CODE)
                                     97 ;--------------------------------------------------------
                                     98 ; Home
                                     99 ;--------------------------------------------------------
                                    100 	.area HOME    (CODE)
                                    101 	.area HOME    (CODE)
                                    102 ;--------------------------------------------------------
                                    103 ; code
                                    104 ;--------------------------------------------------------
                                    105 	.area CSEG    (CODE)
                                    106 ;------------------------------------------------------------
                                    107 ;Allocation info for local variables in function 'wcstombs'
                                    108 ;------------------------------------------------------------
                                    109 ;sloc0                     Allocated with name '_wcstombs_sloc0_1_0'
                                    110 ;sloc1                     Allocated with name '_wcstombs_sloc1_1_0'
                                    111 ;pwcs                      Allocated with name '_wcstombs_PARM_2'
                                    112 ;n                         Allocated with name '_wcstombs_PARM_3'
                                    113 ;s                         Allocated with name '_wcstombs_s_65536_39'
                                    114 ;m                         Allocated with name '_wcstombs_m_65536_40'
                                    115 ;buffer                    Allocated with name '_wcstombs_buffer_65536_40'
                                    116 ;b                         Allocated with name '_wcstombs_b_131072_41'
                                    117 ;------------------------------------------------------------
                                    118 ;	wcstombs.c:33: size_t wcstombs(char *restrict s, const wchar_t *restrict pwcs, size_t n)
                                    119 ;	-----------------------------------------
                                    120 ;	 function wcstombs
                                    121 ;	-----------------------------------------
      000000                        122 _wcstombs:
                           000007   123 	ar7 = 0x07
                           000006   124 	ar6 = 0x06
                           000005   125 	ar5 = 0x05
                           000004   126 	ar4 = 0x04
                           000003   127 	ar3 = 0x03
                           000002   128 	ar2 = 0x02
                           000001   129 	ar1 = 0x01
                           000000   130 	ar0 = 0x00
      000000 AF F0            [24]  131 	mov	r7,b
      000002 AE 83            [24]  132 	mov	r6,dph
      000004 E5 82            [12]  133 	mov	a,dpl
      000006 90r00r05         [24]  134 	mov	dptr,#_wcstombs_s_65536_39
      000009 F0               [24]  135 	movx	@dptr,a
      00000A EE               [12]  136 	mov	a,r6
      00000B A3               [24]  137 	inc	dptr
      00000C F0               [24]  138 	movx	@dptr,a
      00000D EF               [12]  139 	mov	a,r7
      00000E A3               [24]  140 	inc	dptr
      00000F F0               [24]  141 	movx	@dptr,a
                                    142 ;	wcstombs.c:35: size_t m = 0;
      000010 90r00r08         [24]  143 	mov	dptr,#_wcstombs_m_65536_40
      000013 E4               [12]  144 	clr	a
      000014 F0               [24]  145 	movx	@dptr,a
      000015 A3               [24]  146 	inc	dptr
      000016 F0               [24]  147 	movx	@dptr,a
                                    148 ;	wcstombs.c:38: while(n > MB_LEN_MAX || n >= wctomb(buffer, *pwcs))
      000017 90r00r00         [24]  149 	mov	dptr,#_wcstombs_PARM_2
      00001A E0               [24]  150 	movx	a,@dptr
      00001B FD               [12]  151 	mov	r5,a
      00001C A3               [24]  152 	inc	dptr
      00001D E0               [24]  153 	movx	a,@dptr
      00001E FE               [12]  154 	mov	r6,a
      00001F A3               [24]  155 	inc	dptr
      000020 E0               [24]  156 	movx	a,@dptr
      000021 FF               [12]  157 	mov	r7,a
      000022                        158 00107$:
      000022 90r00r03         [24]  159 	mov	dptr,#_wcstombs_PARM_3
      000025 E0               [24]  160 	movx	a,@dptr
      000026 F5*00            [12]  161 	mov	_wcstombs_sloc0_1_0,a
      000028 A3               [24]  162 	inc	dptr
      000029 E0               [24]  163 	movx	a,@dptr
      00002A F5*01            [12]  164 	mov	(_wcstombs_sloc0_1_0 + 1),a
      00002C C3               [12]  165 	clr	c
      00002D 74 04            [12]  166 	mov	a,#0x04
      00002F 95*00            [12]  167 	subb	a,_wcstombs_sloc0_1_0
      000031 E4               [12]  168 	clr	a
      000032 95*01            [12]  169 	subb	a,(_wcstombs_sloc0_1_0 + 1)
      000034 40 4C            [24]  170 	jc	00108$
      000036 8D 82            [24]  171 	mov	dpl,r5
      000038 8E 83            [24]  172 	mov	dph,r6
      00003A 8F F0            [24]  173 	mov	b,r7
      00003C 12r00r00         [24]  174 	lcall	__gptrget
      00003F F8               [12]  175 	mov	r0,a
      000040 A3               [24]  176 	inc	dptr
      000041 12r00r00         [24]  177 	lcall	__gptrget
      000044 F9               [12]  178 	mov	r1,a
      000045 A3               [24]  179 	inc	dptr
      000046 12r00r00         [24]  180 	lcall	__gptrget
      000049 FA               [12]  181 	mov	r2,a
      00004A A3               [24]  182 	inc	dptr
      00004B 12r00r00         [24]  183 	lcall	__gptrget
      00004E FC               [12]  184 	mov	r4,a
      00004F 90r00r00         [24]  185 	mov	dptr,#_wctomb_PARM_2
      000052 E8               [12]  186 	mov	a,r0
      000053 F0               [24]  187 	movx	@dptr,a
      000054 E9               [12]  188 	mov	a,r1
      000055 A3               [24]  189 	inc	dptr
      000056 F0               [24]  190 	movx	@dptr,a
      000057 EA               [12]  191 	mov	a,r2
      000058 A3               [24]  192 	inc	dptr
      000059 F0               [24]  193 	movx	@dptr,a
      00005A EC               [12]  194 	mov	a,r4
      00005B A3               [24]  195 	inc	dptr
      00005C F0               [24]  196 	movx	@dptr,a
      00005D 90r00r0A         [24]  197 	mov	dptr,#_wcstombs_buffer_65536_40
      000060 75 F0 00         [24]  198 	mov	b,#0x00
      000063 C0 07            [24]  199 	push	ar7
      000065 C0 06            [24]  200 	push	ar6
      000067 C0 05            [24]  201 	push	ar5
      000069 12r00r00         [24]  202 	lcall	_wctomb
      00006C AB 82            [24]  203 	mov	r3,dpl
      00006E AC 83            [24]  204 	mov	r4,dph
      000070 D0 05            [24]  205 	pop	ar5
      000072 D0 06            [24]  206 	pop	ar6
      000074 D0 07            [24]  207 	pop	ar7
      000076 C3               [12]  208 	clr	c
      000077 E5*00            [12]  209 	mov	a,_wcstombs_sloc0_1_0
      000079 9B               [12]  210 	subb	a,r3
      00007A E5*01            [12]  211 	mov	a,(_wcstombs_sloc0_1_0 + 1)
      00007C 9C               [12]  212 	subb	a,r4
      00007D 50 03            [24]  213 	jnc	00129$
      00007F 02r01r4A         [24]  214 	ljmp	00109$
      000082                        215 00129$:
      000082                        216 00108$:
                                    217 ;	wcstombs.c:40: int b = wctomb(s, *pwcs);
      000082 90r00r05         [24]  218 	mov	dptr,#_wcstombs_s_65536_39
      000085 E0               [24]  219 	movx	a,@dptr
      000086 F5*02            [12]  220 	mov	_wcstombs_sloc1_1_0,a
      000088 A3               [24]  221 	inc	dptr
      000089 E0               [24]  222 	movx	a,@dptr
      00008A F5*03            [12]  223 	mov	(_wcstombs_sloc1_1_0 + 1),a
      00008C A3               [24]  224 	inc	dptr
      00008D E0               [24]  225 	movx	a,@dptr
      00008E F5*04            [12]  226 	mov	(_wcstombs_sloc1_1_0 + 2),a
      000090 8D 82            [24]  227 	mov	dpl,r5
      000092 8E 83            [24]  228 	mov	dph,r6
      000094 8F F0            [24]  229 	mov	b,r7
      000096 12r00r00         [24]  230 	lcall	__gptrget
      000099 F8               [12]  231 	mov	r0,a
      00009A A3               [24]  232 	inc	dptr
      00009B 12r00r00         [24]  233 	lcall	__gptrget
      00009E F9               [12]  234 	mov	r1,a
      00009F A3               [24]  235 	inc	dptr
      0000A0 12r00r00         [24]  236 	lcall	__gptrget
      0000A3 FB               [12]  237 	mov	r3,a
      0000A4 A3               [24]  238 	inc	dptr
      0000A5 12r00r00         [24]  239 	lcall	__gptrget
      0000A8 FC               [12]  240 	mov	r4,a
      0000A9 90r00r00         [24]  241 	mov	dptr,#_wctomb_PARM_2
      0000AC E8               [12]  242 	mov	a,r0
      0000AD F0               [24]  243 	movx	@dptr,a
      0000AE E9               [12]  244 	mov	a,r1
      0000AF A3               [24]  245 	inc	dptr
      0000B0 F0               [24]  246 	movx	@dptr,a
      0000B1 EB               [12]  247 	mov	a,r3
      0000B2 A3               [24]  248 	inc	dptr
      0000B3 F0               [24]  249 	movx	@dptr,a
      0000B4 EC               [12]  250 	mov	a,r4
      0000B5 A3               [24]  251 	inc	dptr
      0000B6 F0               [24]  252 	movx	@dptr,a
      0000B7 85*02 82         [24]  253 	mov	dpl,_wcstombs_sloc1_1_0
      0000BA 85*03 83         [24]  254 	mov	dph,(_wcstombs_sloc1_1_0 + 1)
      0000BD 85*04 F0         [24]  255 	mov	b,(_wcstombs_sloc1_1_0 + 2)
      0000C0 C0 07            [24]  256 	push	ar7
      0000C2 C0 06            [24]  257 	push	ar6
      0000C4 C0 05            [24]  258 	push	ar5
      0000C6 12r00r00         [24]  259 	lcall	_wctomb
      0000C9 AB 82            [24]  260 	mov	r3,dpl
      0000CB AC 83            [24]  261 	mov	r4,dph
      0000CD D0 05            [24]  262 	pop	ar5
      0000CF D0 06            [24]  263 	pop	ar6
      0000D1 D0 07            [24]  264 	pop	ar7
                                    265 ;	wcstombs.c:42: if(b == 1 && !*s)
      0000D3 BB 01 19         [24]  266 	cjne	r3,#0x01,00102$
      0000D6 BC 00 16         [24]  267 	cjne	r4,#0x00,00102$
      0000D9 90r00r05         [24]  268 	mov	dptr,#_wcstombs_s_65536_39
      0000DC E0               [24]  269 	movx	a,@dptr
      0000DD F8               [12]  270 	mov	r0,a
      0000DE A3               [24]  271 	inc	dptr
      0000DF E0               [24]  272 	movx	a,@dptr
      0000E0 F9               [12]  273 	mov	r1,a
      0000E1 A3               [24]  274 	inc	dptr
      0000E2 E0               [24]  275 	movx	a,@dptr
      0000E3 FA               [12]  276 	mov	r2,a
      0000E4 88 82            [24]  277 	mov	dpl,r0
      0000E6 89 83            [24]  278 	mov	dph,r1
      0000E8 8A F0            [24]  279 	mov	b,r2
      0000EA 12r00r00         [24]  280 	lcall	__gptrget
      0000ED 60 5B            [24]  281 	jz	00109$
                                    282 ;	wcstombs.c:43: break;
      0000EF                        283 00102$:
                                    284 ;	wcstombs.c:44: if(b < 0)
      0000EF EC               [12]  285 	mov	a,r4
      0000F0 30 E7 04         [24]  286 	jnb	acc.7,00105$
                                    287 ;	wcstombs.c:45: return(-1);
      0000F3 90 FF FF         [24]  288 	mov	dptr,#0xffff
      0000F6 22               [24]  289 	ret
      0000F7                        290 00105$:
                                    291 ;	wcstombs.c:47: n -= b;
      0000F7 90r00r03         [24]  292 	mov	dptr,#_wcstombs_PARM_3
      0000FA E0               [24]  293 	movx	a,@dptr
      0000FB F5*02            [12]  294 	mov	_wcstombs_sloc1_1_0,a
      0000FD A3               [24]  295 	inc	dptr
      0000FE E0               [24]  296 	movx	a,@dptr
      0000FF F5*03            [12]  297 	mov	(_wcstombs_sloc1_1_0 + 1),a
      000101 8B*00            [24]  298 	mov	_wcstombs_sloc0_1_0,r3
      000103 8C*01            [24]  299 	mov	(_wcstombs_sloc0_1_0 + 1),r4
      000105 90r00r03         [24]  300 	mov	dptr,#_wcstombs_PARM_3
      000108 E5*02            [12]  301 	mov	a,_wcstombs_sloc1_1_0
      00010A C3               [12]  302 	clr	c
      00010B 95*00            [12]  303 	subb	a,_wcstombs_sloc0_1_0
      00010D F0               [24]  304 	movx	@dptr,a
      00010E E5*03            [12]  305 	mov	a,(_wcstombs_sloc1_1_0 + 1)
      000110 95*01            [12]  306 	subb	a,(_wcstombs_sloc0_1_0 + 1)
      000112 A3               [24]  307 	inc	dptr
      000113 F0               [24]  308 	movx	@dptr,a
                                    309 ;	wcstombs.c:48: m += b;
      000114 90r00r08         [24]  310 	mov	dptr,#_wcstombs_m_65536_40
      000117 E0               [24]  311 	movx	a,@dptr
      000118 F9               [12]  312 	mov	r1,a
      000119 A3               [24]  313 	inc	dptr
      00011A E0               [24]  314 	movx	a,@dptr
      00011B FA               [12]  315 	mov	r2,a
      00011C 90r00r08         [24]  316 	mov	dptr,#_wcstombs_m_65536_40
      00011F E5*00            [12]  317 	mov	a,_wcstombs_sloc0_1_0
      000121 29               [12]  318 	add	a,r1
      000122 F0               [24]  319 	movx	@dptr,a
      000123 E5*01            [12]  320 	mov	a,(_wcstombs_sloc0_1_0 + 1)
      000125 3A               [12]  321 	addc	a,r2
      000126 A3               [24]  322 	inc	dptr
      000127 F0               [24]  323 	movx	@dptr,a
                                    324 ;	wcstombs.c:49: s += b;
      000128 90r00r05         [24]  325 	mov	dptr,#_wcstombs_s_65536_39
      00012B E0               [24]  326 	movx	a,@dptr
      00012C F8               [12]  327 	mov	r0,a
      00012D A3               [24]  328 	inc	dptr
      00012E E0               [24]  329 	movx	a,@dptr
      00012F F9               [12]  330 	mov	r1,a
      000130 A3               [24]  331 	inc	dptr
      000131 E0               [24]  332 	movx	a,@dptr
      000132 FA               [12]  333 	mov	r2,a
      000133 90r00r05         [24]  334 	mov	dptr,#_wcstombs_s_65536_39
      000136 EB               [12]  335 	mov	a,r3
      000137 28               [12]  336 	add	a,r0
      000138 F0               [24]  337 	movx	@dptr,a
      000139 EC               [12]  338 	mov	a,r4
      00013A 39               [12]  339 	addc	a,r1
      00013B A3               [24]  340 	inc	dptr
      00013C F0               [24]  341 	movx	@dptr,a
      00013D EA               [12]  342 	mov	a,r2
      00013E A3               [24]  343 	inc	dptr
      00013F F0               [24]  344 	movx	@dptr,a
                                    345 ;	wcstombs.c:50: pwcs++;
      000140 74 04            [12]  346 	mov	a,#0x04
      000142 2D               [12]  347 	add	a,r5
      000143 FD               [12]  348 	mov	r5,a
      000144 E4               [12]  349 	clr	a
      000145 3E               [12]  350 	addc	a,r6
      000146 FE               [12]  351 	mov	r6,a
      000147 02r00r22         [24]  352 	ljmp	00107$
      00014A                        353 00109$:
                                    354 ;	wcstombs.c:53: return(m);
      00014A 90r00r08         [24]  355 	mov	dptr,#_wcstombs_m_65536_40
      00014D E0               [24]  356 	movx	a,@dptr
      00014E FE               [12]  357 	mov	r6,a
      00014F A3               [24]  358 	inc	dptr
      000150 E0               [24]  359 	movx	a,@dptr
                                    360 ;	wcstombs.c:54: }
      000151 8E 82            [24]  361 	mov	dpl,r6
      000153 F5 83            [12]  362 	mov	dph,a
      000155 22               [24]  363 	ret
                                    364 	.area CSEG    (CODE)
                                    365 	.area CONST   (CODE)
                                    366 	.area XINIT   (CODE)
                                    367 	.area CABS    (ABS,CODE)
