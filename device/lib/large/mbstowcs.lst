                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ISO C Compiler 
                                      3 ; Version 4.2.14 #0 (Linux)
                                      4 ;--------------------------------------------------------
                                      5 	.module mbstowcs
                                      6 	.optsdcc -mmcs51 --model-large
                                      7 	
                                      8 ;--------------------------------------------------------
                                      9 ; Public variables in this module
                                     10 ;--------------------------------------------------------
                                     11 	.globl _mbtowc
                                     12 	.globl _mbstowcs_PARM_3
                                     13 	.globl _mbstowcs_PARM_2
                                     14 	.globl _mbstowcs
                                     15 ;--------------------------------------------------------
                                     16 ; special function registers
                                     17 ;--------------------------------------------------------
                                     18 	.area RSEG    (ABS,DATA)
      000000                         19 	.org 0x0000
                                     20 ;--------------------------------------------------------
                                     21 ; special function bits
                                     22 ;--------------------------------------------------------
                                     23 	.area RSEG    (ABS,DATA)
      000000                         24 	.org 0x0000
                                     25 ;--------------------------------------------------------
                                     26 ; overlayable register banks
                                     27 ;--------------------------------------------------------
                                     28 	.area REG_BANK_0	(REL,OVR,DATA)
      000000                         29 	.ds 8
                                     30 ;--------------------------------------------------------
                                     31 ; internal ram data
                                     32 ;--------------------------------------------------------
                                     33 	.area DSEG    (DATA)
      000000                         34 _mbstowcs_sloc0_1_0:
      000000                         35 	.ds 2
      000002                         36 _mbstowcs_sloc1_1_0:
      000002                         37 	.ds 3
                                     38 ;--------------------------------------------------------
                                     39 ; overlayable items in internal ram
                                     40 ;--------------------------------------------------------
                                     41 ;--------------------------------------------------------
                                     42 ; indirectly addressable internal ram data
                                     43 ;--------------------------------------------------------
                                     44 	.area ISEG    (DATA)
                                     45 ;--------------------------------------------------------
                                     46 ; absolute internal ram data
                                     47 ;--------------------------------------------------------
                                     48 	.area IABS    (ABS,DATA)
                                     49 	.area IABS    (ABS,DATA)
                                     50 ;--------------------------------------------------------
                                     51 ; bit data
                                     52 ;--------------------------------------------------------
                                     53 	.area BSEG    (BIT)
                                     54 ;--------------------------------------------------------
                                     55 ; paged external ram data
                                     56 ;--------------------------------------------------------
                                     57 	.area PSEG    (PAG,XDATA)
                                     58 ;--------------------------------------------------------
                                     59 ; uninitialized external ram data
                                     60 ;--------------------------------------------------------
                                     61 	.area XSEG    (XDATA)
      000000                         62 _mbstowcs_PARM_2:
      000000                         63 	.ds 3
      000003                         64 _mbstowcs_PARM_3:
      000003                         65 	.ds 2
      000005                         66 _mbstowcs_pwcs_65536_39:
      000005                         67 	.ds 3
      000008                         68 _mbstowcs_m_65536_40:
      000008                         69 	.ds 2
                                     70 ;--------------------------------------------------------
                                     71 ; absolute external ram data
                                     72 ;--------------------------------------------------------
                                     73 	.area XABS    (ABS,XDATA)
                                     74 ;--------------------------------------------------------
                                     75 ; initialized external ram data
                                     76 ;--------------------------------------------------------
                                     77 	.area XISEG   (XDATA)
                                     78 	.area HOME    (CODE)
                                     79 	.area GSINIT0 (CODE)
                                     80 	.area GSINIT1 (CODE)
                                     81 	.area GSINIT2 (CODE)
                                     82 	.area GSINIT3 (CODE)
                                     83 	.area GSINIT4 (CODE)
                                     84 	.area GSINIT5 (CODE)
                                     85 	.area GSINIT  (CODE)
                                     86 	.area GSFINAL (CODE)
                                     87 	.area CSEG    (CODE)
                                     88 ;--------------------------------------------------------
                                     89 ; global & static initialisations
                                     90 ;--------------------------------------------------------
                                     91 	.area HOME    (CODE)
                                     92 	.area GSINIT  (CODE)
                                     93 	.area GSFINAL (CODE)
                                     94 	.area GSINIT  (CODE)
                                     95 ;--------------------------------------------------------
                                     96 ; Home
                                     97 ;--------------------------------------------------------
                                     98 	.area HOME    (CODE)
                                     99 	.area HOME    (CODE)
                                    100 ;--------------------------------------------------------
                                    101 ; code
                                    102 ;--------------------------------------------------------
                                    103 	.area CSEG    (CODE)
                                    104 ;------------------------------------------------------------
                                    105 ;Allocation info for local variables in function 'mbstowcs'
                                    106 ;------------------------------------------------------------
                                    107 ;sloc0                     Allocated with name '_mbstowcs_sloc0_1_0'
                                    108 ;sloc1                     Allocated with name '_mbstowcs_sloc1_1_0'
                                    109 ;s                         Allocated with name '_mbstowcs_PARM_2'
                                    110 ;n                         Allocated with name '_mbstowcs_PARM_3'
                                    111 ;pwcs                      Allocated with name '_mbstowcs_pwcs_65536_39'
                                    112 ;m                         Allocated with name '_mbstowcs_m_65536_40'
                                    113 ;b                         Allocated with name '_mbstowcs_b_131072_41'
                                    114 ;------------------------------------------------------------
                                    115 ;	mbstowcs.c:33: size_t mbstowcs(wchar_t *restrict pwcs, const char *restrict s, size_t n)
                                    116 ;	-----------------------------------------
                                    117 ;	 function mbstowcs
                                    118 ;	-----------------------------------------
      000000                        119 _mbstowcs:
                           000007   120 	ar7 = 0x07
                           000006   121 	ar6 = 0x06
                           000005   122 	ar5 = 0x05
                           000004   123 	ar4 = 0x04
                           000003   124 	ar3 = 0x03
                           000002   125 	ar2 = 0x02
                           000001   126 	ar1 = 0x01
                           000000   127 	ar0 = 0x00
      000000 AF F0            [24]  128 	mov	r7,b
      000002 AE 83            [24]  129 	mov	r6,dph
      000004 E5 82            [12]  130 	mov	a,dpl
      000006 90r00r05         [24]  131 	mov	dptr,#_mbstowcs_pwcs_65536_39
      000009 F0               [24]  132 	movx	@dptr,a
      00000A EE               [12]  133 	mov	a,r6
      00000B A3               [24]  134 	inc	dptr
      00000C F0               [24]  135 	movx	@dptr,a
      00000D EF               [12]  136 	mov	a,r7
      00000E A3               [24]  137 	inc	dptr
      00000F F0               [24]  138 	movx	@dptr,a
                                    139 ;	mbstowcs.c:35: size_t m = 0;
      000010 90r00r08         [24]  140 	mov	dptr,#_mbstowcs_m_65536_40
      000013 E4               [12]  141 	clr	a
      000014 F0               [24]  142 	movx	@dptr,a
      000015 A3               [24]  143 	inc	dptr
      000016 F0               [24]  144 	movx	@dptr,a
                                    145 ;	mbstowcs.c:36: while(n--)
      000017 90r00r05         [24]  146 	mov	dptr,#_mbstowcs_pwcs_65536_39
      00001A E0               [24]  147 	movx	a,@dptr
      00001B FD               [12]  148 	mov	r5,a
      00001C A3               [24]  149 	inc	dptr
      00001D E0               [24]  150 	movx	a,@dptr
      00001E FE               [12]  151 	mov	r6,a
      00001F A3               [24]  152 	inc	dptr
      000020 E0               [24]  153 	movx	a,@dptr
      000021 FF               [12]  154 	mov	r7,a
      000022 E4               [12]  155 	clr	a
      000023 F5*00            [12]  156 	mov	_mbstowcs_sloc0_1_0,a
      000025 F5*01            [12]  157 	mov	(_mbstowcs_sloc0_1_0 + 1),a
      000027 90r00r03         [24]  158 	mov	dptr,#_mbstowcs_PARM_3
      00002A E0               [24]  159 	movx	a,@dptr
      00002B F9               [12]  160 	mov	r1,a
      00002C A3               [24]  161 	inc	dptr
      00002D E0               [24]  162 	movx	a,@dptr
      00002E FA               [12]  163 	mov	r2,a
      00002F                        164 00105$:
      00002F 89 00            [24]  165 	mov	ar0,r1
      000031 8A 04            [24]  166 	mov	ar4,r2
      000033 19               [12]  167 	dec	r1
      000034 B9 FF 01         [24]  168 	cjne	r1,#0xff,00126$
      000037 1A               [12]  169 	dec	r2
      000038                        170 00126$:
      000038 E8               [12]  171 	mov	a,r0
      000039 4C               [12]  172 	orl	a,r4
      00003A 70 03            [24]  173 	jnz	00127$
      00003C 02r00rE2         [24]  174 	ljmp	00107$
      00003F                        175 00127$:
                                    176 ;	mbstowcs.c:38: int b = mbtowc(pwcs++, s, MB_LEN_MAX);
      00003F C0 01            [24]  177 	push	ar1
      000041 C0 02            [24]  178 	push	ar2
      000043 8D*02            [24]  179 	mov	_mbstowcs_sloc1_1_0,r5
      000045 8E*03            [24]  180 	mov	(_mbstowcs_sloc1_1_0 + 1),r6
      000047 8F*04            [24]  181 	mov	(_mbstowcs_sloc1_1_0 + 2),r7
      000049 74 04            [12]  182 	mov	a,#0x04
      00004B 2D               [12]  183 	add	a,r5
      00004C FD               [12]  184 	mov	r5,a
      00004D E4               [12]  185 	clr	a
      00004E 3E               [12]  186 	addc	a,r6
      00004F FE               [12]  187 	mov	r6,a
      000050 90r00r05         [24]  188 	mov	dptr,#_mbstowcs_pwcs_65536_39
      000053 ED               [12]  189 	mov	a,r5
      000054 F0               [24]  190 	movx	@dptr,a
      000055 EE               [12]  191 	mov	a,r6
      000056 A3               [24]  192 	inc	dptr
      000057 F0               [24]  193 	movx	@dptr,a
      000058 EF               [12]  194 	mov	a,r7
      000059 A3               [24]  195 	inc	dptr
      00005A F0               [24]  196 	movx	@dptr,a
      00005B 90r00r00         [24]  197 	mov	dptr,#_mbstowcs_PARM_2
      00005E E0               [24]  198 	movx	a,@dptr
      00005F F9               [12]  199 	mov	r1,a
      000060 A3               [24]  200 	inc	dptr
      000061 E0               [24]  201 	movx	a,@dptr
      000062 FA               [12]  202 	mov	r2,a
      000063 A3               [24]  203 	inc	dptr
      000064 E0               [24]  204 	movx	a,@dptr
      000065 FC               [12]  205 	mov	r4,a
      000066 90r00r00         [24]  206 	mov	dptr,#_mbtowc_PARM_2
      000069 E9               [12]  207 	mov	a,r1
      00006A F0               [24]  208 	movx	@dptr,a
      00006B EA               [12]  209 	mov	a,r2
      00006C A3               [24]  210 	inc	dptr
      00006D F0               [24]  211 	movx	@dptr,a
      00006E EC               [12]  212 	mov	a,r4
      00006F A3               [24]  213 	inc	dptr
      000070 F0               [24]  214 	movx	@dptr,a
      000071 90r00r00         [24]  215 	mov	dptr,#_mbtowc_PARM_3
      000074 74 04            [12]  216 	mov	a,#0x04
      000076 F0               [24]  217 	movx	@dptr,a
      000077 E4               [12]  218 	clr	a
      000078 A3               [24]  219 	inc	dptr
      000079 F0               [24]  220 	movx	@dptr,a
      00007A 85*02 82         [24]  221 	mov	dpl,_mbstowcs_sloc1_1_0
      00007D 85*03 83         [24]  222 	mov	dph,(_mbstowcs_sloc1_1_0 + 1)
      000080 85*04 F0         [24]  223 	mov	b,(_mbstowcs_sloc1_1_0 + 2)
      000083 C0 07            [24]  224 	push	ar7
      000085 C0 06            [24]  225 	push	ar6
      000087 C0 05            [24]  226 	push	ar5
      000089 C0 02            [24]  227 	push	ar2
      00008B C0 01            [24]  228 	push	ar1
      00008D 12r00r00         [24]  229 	lcall	_mbtowc
      000090 85 82*02         [24]  230 	mov	_mbstowcs_sloc1_1_0,dpl
      000093 85 83*03         [24]  231 	mov	(_mbstowcs_sloc1_1_0 + 1),dph
      000096 D0 01            [24]  232 	pop	ar1
      000098 D0 02            [24]  233 	pop	ar2
      00009A D0 05            [24]  234 	pop	ar5
      00009C D0 06            [24]  235 	pop	ar6
      00009E D0 07            [24]  236 	pop	ar7
                                    237 ;	mbstowcs.c:39: if(!b)
      0000A0 D0 02            [24]  238 	pop	ar2
      0000A2 D0 01            [24]  239 	pop	ar1
      0000A4 E5*02            [12]  240 	mov	a,_mbstowcs_sloc1_1_0
      0000A6 45*03            [12]  241 	orl	a,(_mbstowcs_sloc1_1_0 + 1)
      0000A8 60 38            [24]  242 	jz	00107$
                                    243 ;	mbstowcs.c:41: if(b < 0)
      0000AA E5*03            [12]  244 	mov	a,(_mbstowcs_sloc1_1_0 + 1)
      0000AC 30 E7 04         [24]  245 	jnb	acc.7,00104$
                                    246 ;	mbstowcs.c:42: return(-1);
      0000AF 90 FF FF         [24]  247 	mov	dptr,#0xffff
      0000B2 22               [24]  248 	ret
      0000B3                        249 00104$:
                                    250 ;	mbstowcs.c:43: s += b;
      0000B3 90r00r00         [24]  251 	mov	dptr,#_mbstowcs_PARM_2
      0000B6 E0               [24]  252 	movx	a,@dptr
      0000B7 F8               [12]  253 	mov	r0,a
      0000B8 A3               [24]  254 	inc	dptr
      0000B9 E0               [24]  255 	movx	a,@dptr
      0000BA FB               [12]  256 	mov	r3,a
      0000BB A3               [24]  257 	inc	dptr
      0000BC E0               [24]  258 	movx	a,@dptr
      0000BD FC               [12]  259 	mov	r4,a
      0000BE 90r00r00         [24]  260 	mov	dptr,#_mbstowcs_PARM_2
      0000C1 E5*02            [12]  261 	mov	a,_mbstowcs_sloc1_1_0
      0000C3 28               [12]  262 	add	a,r0
      0000C4 F0               [24]  263 	movx	@dptr,a
      0000C5 E5*03            [12]  264 	mov	a,(_mbstowcs_sloc1_1_0 + 1)
      0000C7 3B               [12]  265 	addc	a,r3
      0000C8 A3               [24]  266 	inc	dptr
      0000C9 F0               [24]  267 	movx	@dptr,a
      0000CA EC               [12]  268 	mov	a,r4
      0000CB A3               [24]  269 	inc	dptr
      0000CC F0               [24]  270 	movx	@dptr,a
                                    271 ;	mbstowcs.c:44: m++;
      0000CD 05*00            [12]  272 	inc	_mbstowcs_sloc0_1_0
      0000CF E4               [12]  273 	clr	a
      0000D0 B5*00 02         [24]  274 	cjne	a,_mbstowcs_sloc0_1_0,00130$
      0000D3 05*01            [12]  275 	inc	(_mbstowcs_sloc0_1_0 + 1)
      0000D5                        276 00130$:
      0000D5 90r00r08         [24]  277 	mov	dptr,#_mbstowcs_m_65536_40
      0000D8 E5*00            [12]  278 	mov	a,_mbstowcs_sloc0_1_0
      0000DA F0               [24]  279 	movx	@dptr,a
      0000DB E5*01            [12]  280 	mov	a,(_mbstowcs_sloc0_1_0 + 1)
      0000DD A3               [24]  281 	inc	dptr
      0000DE F0               [24]  282 	movx	@dptr,a
      0000DF 02r00r2F         [24]  283 	ljmp	00105$
      0000E2                        284 00107$:
                                    285 ;	mbstowcs.c:47: return(m);
      0000E2 90r00r08         [24]  286 	mov	dptr,#_mbstowcs_m_65536_40
      0000E5 E0               [24]  287 	movx	a,@dptr
      0000E6 FE               [12]  288 	mov	r6,a
      0000E7 A3               [24]  289 	inc	dptr
      0000E8 E0               [24]  290 	movx	a,@dptr
                                    291 ;	mbstowcs.c:48: }
      0000E9 8E 82            [24]  292 	mov	dpl,r6
      0000EB F5 83            [12]  293 	mov	dph,a
      0000ED 22               [24]  294 	ret
                                    295 	.area CSEG    (CODE)
                                    296 	.area CONST   (CODE)
                                    297 	.area XINIT   (CODE)
                                    298 	.area CABS    (ABS,CODE)
