                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ISO C Compiler 
                                      3 ; Version 4.2.14 #0 (Linux)
                                      4 ;--------------------------------------------------------
                                      5 	.module _autobaud
                                      6 	.optsdcc -mds390 --model-flat24
                                      7 	
                                      8 ;--------------------------------------------------------
                                      9 ; CPU specific extensions
                                     10 ;--------------------------------------------------------
                                     11 	.DS80C390
                                     12 	.amode	2	; 24 bit flat addressing
                           000082    13 dpl	=	0x82
                           000083    14 dph	=	0x83
                           000084    15 dpl1	=	0x84
                           000085    16 dph1	=	0x85
                           000086    17 dps	=	0x86
                           000093    18 dpx	=	0x93
                           000095    19 dpx1	=	0x95
                           00009B    20 esp	=	0x9B
                           00009C    21 ap	=	0x9C
                           00009C    22 acc1	=	0x9C
                           0000D1    23 mcnt0	=	0xD1
                           0000D2    24 mcnt1	=	0xD2
                           0000D3    25 ma	=	0xD3
                           0000D4    26 mb	=	0xD4
                           0000D5    27 mc	=	0xD5
                           00009D    28 acon	=	0x9D
                           0000C6    29 mcon	=	0xC6
                           0000D1    30 F1	=	0xD1	; user flag
                                     31 ;--------------------------------------------------------
                                     32 ; Public variables in this module
                                     33 ;--------------------------------------------------------
                                     34 	.globl _autobaud
                                     35 ;--------------------------------------------------------
                                     36 ; special function registers
                                     37 ;--------------------------------------------------------
                           000080    38 _P0	=	0x0080
                           000081    39 _SP	=	0x0081
                           000082    40 _DPL	=	0x0082
                           000083    41 _DPH	=	0x0083
                           000087    42 _PCON	=	0x0087
                           000088    43 _TCON	=	0x0088
                           000089    44 _TMOD	=	0x0089
                           00008A    45 _TL0	=	0x008a
                           00008B    46 _TL1	=	0x008b
                           00008C    47 _TH0	=	0x008c
                           00008D    48 _TH1	=	0x008d
                           000090    49 _P1	=	0x0090
                           000098    50 _SCON	=	0x0098
                           000099    51 _SBUF	=	0x0099
                           0000A0    52 _P2	=	0x00a0
                           0000A8    53 _IE	=	0x00a8
                           0000B0    54 _P3	=	0x00b0
                           0000B8    55 _IP	=	0x00b8
                           0000D0    56 _PSW	=	0x00d0
                           0000E0    57 _ACC	=	0x00e0
                           0000F0    58 _B	=	0x00f0
                                     59 ;--------------------------------------------------------
                                     60 ; special function bits
                                     61 ;--------------------------------------------------------
                           000080    62 _P0_0	=	0x0080
                           000081    63 _P0_1	=	0x0081
                           000082    64 _P0_2	=	0x0082
                           000083    65 _P0_3	=	0x0083
                           000084    66 _P0_4	=	0x0084
                           000085    67 _P0_5	=	0x0085
                           000086    68 _P0_6	=	0x0086
                           000087    69 _P0_7	=	0x0087
                           000088    70 _IT0	=	0x0088
                           000089    71 _IE0	=	0x0089
                           00008A    72 _IT1	=	0x008a
                           00008B    73 _IE1	=	0x008b
                           00008C    74 _TR0	=	0x008c
                           00008D    75 _TF0	=	0x008d
                           00008E    76 _TR1	=	0x008e
                           00008F    77 _TF1	=	0x008f
                           000090    78 _P1_0	=	0x0090
                           000091    79 _P1_1	=	0x0091
                           000092    80 _P1_2	=	0x0092
                           000093    81 _P1_3	=	0x0093
                           000094    82 _P1_4	=	0x0094
                           000095    83 _P1_5	=	0x0095
                           000096    84 _P1_6	=	0x0096
                           000097    85 _P1_7	=	0x0097
                           000098    86 _RI	=	0x0098
                           000099    87 _TI	=	0x0099
                           00009A    88 _RB8	=	0x009a
                           00009B    89 _TB8	=	0x009b
                           00009C    90 _REN	=	0x009c
                           00009D    91 _SM2	=	0x009d
                           00009E    92 _SM1	=	0x009e
                           00009F    93 _SM0	=	0x009f
                           0000A0    94 _P2_0	=	0x00a0
                           0000A1    95 _P2_1	=	0x00a1
                           0000A2    96 _P2_2	=	0x00a2
                           0000A3    97 _P2_3	=	0x00a3
                           0000A4    98 _P2_4	=	0x00a4
                           0000A5    99 _P2_5	=	0x00a5
                           0000A6   100 _P2_6	=	0x00a6
                           0000A7   101 _P2_7	=	0x00a7
                           0000A8   102 _EX0	=	0x00a8
                           0000A9   103 _ET0	=	0x00a9
                           0000AA   104 _EX1	=	0x00aa
                           0000AB   105 _ET1	=	0x00ab
                           0000AC   106 _ES	=	0x00ac
                           0000AF   107 _EA	=	0x00af
                           0000B0   108 _P3_0	=	0x00b0
                           0000B1   109 _P3_1	=	0x00b1
                           0000B2   110 _P3_2	=	0x00b2
                           0000B3   111 _P3_3	=	0x00b3
                           0000B4   112 _P3_4	=	0x00b4
                           0000B5   113 _P3_5	=	0x00b5
                           0000B6   114 _P3_6	=	0x00b6
                           0000B7   115 _P3_7	=	0x00b7
                           0000B0   116 _RXD	=	0x00b0
                           0000B1   117 _TXD	=	0x00b1
                           0000B2   118 _INT0	=	0x00b2
                           0000B3   119 _INT1	=	0x00b3
                           0000B4   120 _T0	=	0x00b4
                           0000B5   121 _T1	=	0x00b5
                           0000B6   122 _WR	=	0x00b6
                           0000B7   123 _RD	=	0x00b7
                           0000B8   124 _PX0	=	0x00b8
                           0000B9   125 _PT0	=	0x00b9
                           0000BA   126 _PX1	=	0x00ba
                           0000BB   127 _PT1	=	0x00bb
                           0000BC   128 _PS	=	0x00bc
                           0000D0   129 _P	=	0x00d0
                           0000D1   130 _F1	=	0x00d1
                           0000D2   131 _OV	=	0x00d2
                           0000D3   132 _RS0	=	0x00d3
                           0000D4   133 _RS1	=	0x00d4
                           0000D5   134 _F0	=	0x00d5
                           0000D6   135 _AC	=	0x00d6
                           0000D7   136 _CY	=	0x00d7
                                    137 ;--------------------------------------------------------
                                    138 ; overlayable register banks
                                    139 ;--------------------------------------------------------
                                    140 	.area REG_BANK_0	(REL,OVR,DATA)
      000000                        141 	.ds 8
                                    142 ;--------------------------------------------------------
                                    143 ; internal ram data
                                    144 ;--------------------------------------------------------
                                    145 	.area DSEG    (DATA)
                                    146 ;--------------------------------------------------------
                                    147 ; overlayable items in internal ram
                                    148 ;--------------------------------------------------------
                                    149 ;--------------------------------------------------------
                                    150 ; indirectly addressable internal ram data
                                    151 ;--------------------------------------------------------
                                    152 	.area ISEG    (DATA)
                                    153 ;--------------------------------------------------------
                                    154 ; absolute internal ram data
                                    155 ;--------------------------------------------------------
                                    156 	.area IABS    (ABS,DATA)
                                    157 	.area IABS    (ABS,DATA)
                                    158 ;--------------------------------------------------------
                                    159 ; bit data
                                    160 ;--------------------------------------------------------
                                    161 	.area BSEG    (BIT)
                                    162 ;--------------------------------------------------------
                                    163 ; paged external ram data
                                    164 ;--------------------------------------------------------
                                    165 	.area PSEG    (PAG,XDATA)
                                    166 ;--------------------------------------------------------
                                    167 ; uninitialized external ram data
                                    168 ;--------------------------------------------------------
                                    169 	.area XSEG    (XDATA)
                                    170 ;--------------------------------------------------------
                                    171 ; absolute external ram data
                                    172 ;--------------------------------------------------------
                                    173 	.area XABS    (ABS,XDATA)
                                    174 ;--------------------------------------------------------
                                    175 ; initialized external ram data
                                    176 ;--------------------------------------------------------
                                    177 	.area XISEG   (XDATA)
                                    178 ;--------------------------------------------------------
                                    179 ; global & static initialisations
                                    180 ;--------------------------------------------------------
                                    181 	.area HOME    (CODE)
                                    182 	.area GSINIT  (CODE)
                                    183 	.area GSFINAL (CODE)
                                    184 	.area GSINIT  (CODE)
                                    185 ;--------------------------------------------------------
                                    186 ; Home
                                    187 ;--------------------------------------------------------
                                    188 	.area HOME    (CODE)
                                    189 	.area HOME    (CODE)
                                    190 ;--------------------------------------------------------
                                    191 ; code
                                    192 ;--------------------------------------------------------
                                    193 	.area CSEG    (CODE)
                                    194 ;------------------------------------------------------------
                                    195 ;Allocation info for local variables in function 'autobaud'
                                    196 ;------------------------------------------------------------
                                    197 ;	_autobaud.c:57: void autobaud ()
                                    198 ;	-----------------------------------------
                                    199 ;	 function autobaud
                                    200 ;	-----------------------------------------
      000000                        201 _autobaud:
                           000002   202 	ar2 = 0x02
                           000003   203 	ar3 = 0x03
                           000004   204 	ar4 = 0x04
                           000005   205 	ar5 = 0x05
                           000006   206 	ar6 = 0x06
                           000007   207 	ar7 = 0x07
                           000000   208 	ar0 = 0x00
                           000001   209 	ar1 = 0x01
                                    210 ;	_autobaud.c:61: TMOD=0x11;
                                    211 ;	genAssign: resultIsFar = FALSE
      000000 75 89 11         [12]  212 	mov	_TMOD,#0x11
                                    213 ;	_autobaud.c:62: TCON = 0;
                                    214 ;	genAssign: resultIsFar = FALSE
      000003 75 88 00         [12]  215 	mov	_TCON,#0x00
                                    216 ;	_autobaud.c:63: TH1 = TL1 = 0;
                                    217 ;	genAssign: resultIsFar = FALSE
      000006 75 8B 00         [12]  218 	mov	_TL1,#0x00
                                    219 ;	genAssign: resultIsFar = FALSE
      000009 75 8D 00         [12]  220 	mov	_TH1,#0x00
                                    221 ;	_autobaud.c:67: while(RXD) ; 
      00000C                        222 00102$:
      00000C 20 B0 FD         [12]  223 	jb   _RXD,00102$
      00000F                        224 00178$:
                                    225 ;	_autobaud.c:71: if (RXD) goto autobaud2;
      00000F 20 B0 FA         [12]  226 	jb   _RXD,00102$
      000012                        227 00179$:
                                    228 ;	_autobaud.c:72: if (RXD) goto autobaud2;
      000012 20 B0 F7         [12]  229 	jb   _RXD,00102$
      000015                        230 00180$:
                                    231 ;	_autobaud.c:73: if (RXD) goto autobaud2;
      000015 20 B0 F4         [12]  232 	jb   _RXD,00102$
      000018                        233 00181$:
                                    234 ;	_autobaud.c:74: if (RXD) goto autobaud2;
      000018 20 B0 F1         [12]  235 	jb   _RXD,00102$
      00001B                        236 00182$:
                                    237 ;	_autobaud.c:77: while (!RXD);
      00001B                        238 00113$:
      00001B 30 B0 FD         [12]  239 	jnb  _RXD,00113$
      00001E                        240 00183$:
                                    241 ;	_autobaud.c:78: TR1 = 1; /* start the timer */
                                    242 ;	genAssign: resultIsFar = FALSE
      00001E D2 8E            [ 8]  243 	setb	_TR1
                                    244 ;	_autobaud.c:79: while (RXD);             // wait for bit #1 to begin
      000020                        245 00116$:
      000020 20 B0 FD         [12]  246 	jb   _RXD,00116$
      000023                        247 00184$:
                                    248 ;	_autobaud.c:80: while(!RXD);             // wait for bit #2 to begin
      000023                        249 00119$:
      000023 30 B0 FD         [12]  250 	jnb  _RXD,00119$
      000026                        251 00185$:
                                    252 ;	_autobaud.c:81: while(RXD);              // wait for bit #4 to begin
      000026                        253 00122$:
      000026 20 B0 FD         [12]  254 	jb   _RXD,00122$
      000029                        255 00186$:
                                    256 ;	_autobaud.c:82: while (!RXD);            // wait for stop bit to begin
      000029                        257 00125$:
      000029 30 B0 FD         [12]  258 	jnb  _RXD,00125$
      00002C                        259 00187$:
                                    260 ;	_autobaud.c:83: TR1 = 0;                 // stop timing
                                    261 ;	genAssign: resultIsFar = FALSE
      00002C C2 8E            [ 8]  262 	clr	_TR1
                                    263 ;	_autobaud.c:86: TH1 = (TH1 << 1) | (TL1 >> 7);
      00002E AA 8D            [ 8]  264 	mov	r2,_TH1
      000030 EA               [ 4]  265 	mov	a,r2
      000031 25 E0            [ 8]  266 	add	a,acc
      000033 FA               [ 4]  267 	mov	r2,a
      000034 E5 8B            [ 8]  268 	mov	a,_TL1
      000036 23               [ 4]  269 	rl	a
      000037 54 01            [ 8]  270 	anl	a,#0x01
      000039 FB               [ 4]  271 	mov  r3,a
      00003A 4A               [ 4]  272 	orl	a,r2
      00003B F5 8D            [ 8]  273 	mov	_TH1,a
                                    274 ;	_autobaud.c:89: TH1 = (TH1 << 1) | ((TL1 >> 6) & 0x01);
      00003D AA 8D            [ 8]  275 	mov	r2,_TH1
      00003F EA               [ 4]  276 	mov	a,r2
      000040 25 E0            [ 8]  277 	add	a,acc
      000042 FA               [ 4]  278 	mov	r2,a
      000043 E5 8B            [ 8]  279 	mov	a,_TL1
      000045 23               [ 4]  280 	rl	a
      000046 23               [ 4]  281 	rl	a
      000047 54 01            [ 8]  282 	anl	a,#0x01
      000049 FB               [ 4]  283 	mov  r3,a
      00004A 4A               [ 4]  284 	orl	a,r2
                                    285 ;	_autobaud.c:92: TH1 = ~TH1;
      00004B F4               [ 4]  286 	cpl  a
                                    287 ;	_autobaud.c:95: TH1++ ;
      00004C 04               [ 4]  288 	inc  a
      00004D F5 8D            [ 8]  289 	mov  _TH1,a
                                    290 ;	_autobaud.c:97: TL1 = TH1;
                                    291 ;	genAssign: resultIsFar = FALSE
      00004F 85 8D 8B         [12]  292 	mov	_TL1,_TH1
                                    293 ;	_autobaud.c:98: TMOD =  0x21     ;      // set timer #1 for 8 bit auto-reload
                                    294 ;	genAssign: resultIsFar = FALSE
      000052 75 89 21         [12]  295 	mov	_TMOD,#0x21
                                    296 ;	_autobaud.c:99: PCON =  0x80     ;      // configure built-in uart
                                    297 ;	genAssign: resultIsFar = FALSE
      000055 75 87 80         [12]  298 	mov	_PCON,#0x80
                                    299 ;	_autobaud.c:100: SCON =  0x52     ;
                                    300 ;	genAssign: resultIsFar = FALSE
      000058 75 98 52         [12]  301 	mov	_SCON,#0x52
      00005B                        302 00128$:
                                    303 ;	_autobaud.c:101: }
      00005B 22               [16]  304 	ret
                                    305 	.area CSEG    (CODE)
                                    306 	.area CONST   (CODE)
                                    307 	.area XINIT   (CODE)
                                    308 	.area CABS    (ABS,CODE)
